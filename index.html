<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PDAM AI - Sistem Pengolahan Air Terintegrasi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <!-- Leaflet CSS & JS untuk peta (gratis, tidak butuh API key) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Three.js untuk visualisasi 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <!-- jsPDF untuk ekspor PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Chart.js untuk visualisasi data -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --dark-yellow: #FFD700;
            --mid-yellow: #FFE44D;
            --light-yellow: #FFF8B2;
            --dark-black: #111111;
            --mid-black: #222222;
            --light-black: #333333;
            --accent-yellow: #FFC107;
            --accent-light: #FFEE99;
            --primary: #FF9800;
            --secondary: #4CAF50;
            --warning: #FF5722;
            --danger: #F44336;
            --light: #FFFDE7;
            --gray: #757575;
            --gray-light: #424242;
            --water-blue: #2196F3;
            --water-light: #64B5F6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--light);
            background: linear-gradient(135deg, var(--dark-black) 0%, var(--mid-black) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            border-radius: 50%;
            justify-content: center;
            align-items: center;
            color: var(--dark-black);
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .mobile-header {
            display: none;
            padding: 15px;
            background: rgba(34, 34, 34, 0.95);
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .mobile-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mobile-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mobile-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--dark-black);
        }
        
        .mobile-logo-text h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            background: linear-gradient(to right, var(--accent-yellow), var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Touch-friendly button sizes */
        .btn {
            min-height: 44px;
            min-width: 44px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            color: var(--dark-black);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            touch-action: manipulation;
            user-select: none;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .export-btn, .map-control-btn, .control-btn-3d {
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Dashboard Container */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* Sidebar - Mobile Optimized */
        .sidebar {
            width: 280px;
            background: rgba(34, 34, 34, 0.95);
            padding: 25px 20px;
            border-right: 1px solid rgba(255, 193, 7, 0.2);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }
        
        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--dark-black);
        }
        
        .logo-text h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            background: linear-gradient(to right, var(--accent-yellow), var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo-text p {
            font-size: 0.8rem;
            color: var(--accent-light);
        }
        
        .nav-menu {
            flex: 1;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            color: #E0E0E0;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 56px;
            user-select: none;
        }
        
        .nav-item:active {
            transform: scale(0.98);
        }
        
        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.2) 0%, rgba(255, 193, 7, 0.1) 100%);
            color: white;
            border-left: 4px solid var(--accent-yellow);
        }
        
        .nav-item i {
            width: 24px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        /* PROFIL DI SIDEBAR */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 193, 7, 0.2);
            margin-top: 20px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--dark-black);
        }
        
        .user-info h4 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: white;
        }
        
        .user-info p {
            font-size: 0.85rem;
            color: var(--accent-light);
        }
        
        /* Main Content - Mobile Optimized */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 25px;
            width: calc(100% - 280px);
            min-height: 100vh;
            overflow-y: auto;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .top-bar h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            background: linear-gradient(to right, var(--accent-yellow), var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .top-bar-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        /* Dashboard Content */
        .dashboard-content {
            display: none;
            min-height: 100vh;
        }
        
        .dashboard-content.active {
            display: block;
        }
        
        /* Dashboard Sections */
        .dashboard-section {
            background: rgba(51, 51, 51, 0.8);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 193, 7, 0.1);
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            color: var(--accent-yellow);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 193, 7, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title i {
            font-size: 1.6rem;
        }
        
        /* Dashboard Grid - Mobile Responsive */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Stat Cards */
        .stat-card {
            background: linear-gradient(135deg, rgba(51, 51, 51, 0.9) 0%, rgba(255, 152, 0, 0.2) 100%);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            transition: transform 0.3s;
            min-height: 120px;
        }
        
        .stat-card:active {
            transform: translateY(-2px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--dark-black);
            flex-shrink: 0;
        }
        
        .stat-info h3 {
            font-size: 0.9rem;
            color: #BDBDBD;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-yellow);
            margin-bottom: 5px;
        }
        
        .stat-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .change-positive {
            color: var(--secondary);
        }
        
        .change-negative {
            color: var(--danger);
        }
        
        /* Bottle Selection */
        .bottle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .bottle-card {
            background: rgba(51, 51, 51, 0.7);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .bottle-card:active {
            transform: translateY(-5px);
        }
        
        .bottle-card.active {
            border-color: var(--accent-yellow);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        
        .bottle-icon {
            width: 80px;
            height: 160px;
            margin: 0 auto 15px;
            position: relative;
        }
        
        .bottle-body {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px 20px 10px 10px;
            border: 2px solid rgba(255, 193, 7, 0.3);
            overflow: hidden;
        }
        
        .bottle-water {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, var(--water-blue), var(--water-light));
            transition: height 0.5s;
        }
        
        .bottle-neck {
            position: absolute;
            width: 40%;
            height: 30%;
            top: -30%;
            left: 30%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px 15px 0 0;
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-bottom: none;
        }
        
        .bottle-cap {
            position: absolute;
            width: 50%;
            height: 10%;
            top: -40%;
            left: 25%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px 10px 5px 5px;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        .bottle-info h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: white;
        }
        
        .bottle-info p {
            color: var(--accent-light);
            font-size: 0.9rem;
        }
        
        /* Map Section */
        #pdamMap {
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 193, 7, 0.3);
            margin-top: 20px;
            position: relative;
        }
        
        .map-container {
            width: 100%;
            height: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .map-control-btn {
            background: rgba(34, 34, 34, 0.9);
            color: white;
            border: 1px solid rgba(255, 193, 7, 0.5);
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
            min-height: 44px;
        }
        
        .map-control-btn:active {
            background: rgba(255, 193, 7, 0.2);
            transform: translateY(-2px);
        }
        
        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            max-width: 250px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        /* Process Visualization */
        .process-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 1200px) {
            .process-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* 3D Process Visualization */
        .process-visual-3d {
            height: 400px;
            background: #111;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        #process3D {
            width: 100%;
            height: 100%;
        }
        
        .process-controls {
            background: rgba(51, 51, 51, 0.7);
            border-radius: 15px;
            padding: 25px;
        }
        
        /* Process Steps in 3D View */
        .process-step-3d {
            position: absolute;
            padding: 10px 15px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 8px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 10;
            border: 2px solid;
            transition: all 0.3s;
        }
        
        .process-step-active {
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.8);
            transform: scale(1.1);
        }
        
        /* History Table */
        .history-table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 15px;
            border: 1px solid rgba(255, 193, 7, 0.2);
            background: rgba(34, 34, 34, 0.5);
            margin-top: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .history-table thead {
            position: sticky;
            top: 0;
            background: rgba(255, 152, 0, 0.9);
            color: var(--dark-black);
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .history-table th, .history-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 193, 7, 0.1);
        }
        
        .history-table tbody tr:active {
            background-color: rgba(255, 193, 7, 0.05);
        }
        
        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-container {
            background: rgba(51, 51, 51, 0.7);
            border-radius: 15px;
            padding: 20px;
            height: 300px;
        }
        
        /* Buttons */
        .btn-success {
            background: linear-gradient(135deg, var(--secondary), #2E7D32);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #D84315);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #C62828);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent-yellow);
            color: var(--accent-yellow);
        }
        
        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--secondary), #2E7D32);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            min-height: 44px;
        }
        
        .export-btn:active {
            transform: scale(0.98);
        }
        
        .export-btn.pdf {
            background: linear-gradient(135deg, #F44336, #D32F2F);
        }
        
        .export-btn.csv {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        /* History Controls */
        .history-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        /* Process Steps */
        .process-status {
            background: rgba(51, 51, 51, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Team Section */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .team-card {
            background: rgba(51, 51, 51, 0.7);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s;
            border: 1px solid rgba(255, 193, 7, 0.2);
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .team-card:active {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--accent-yellow);
        }
        
        .team-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid;
        }
        
        .team-info h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .team-info p {
            color: var(--accent-light);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .team-role {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { opacity: 0.4; box-shadow: 0 0 10px var(--accent-yellow); }
            50% { opacity: 1; box-shadow: 0 0 25px var(--accent-yellow); }
            100% { opacity: 0.4; box-shadow: 0 0 10px var(--accent-yellow); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes waterFlow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .water-flow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.4), transparent);
            animation: waterFlow 2s infinite linear;
            z-index: 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(51, 51, 51, 0.5);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--accent-yellow), var(--primary));
            border-radius: 5px;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Animasi untuk process steps */
        @keyframes stepActive {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
        
        .step-active {
            animation: stepActive 2s infinite;
        }
        
        /* Loader */
        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 193, 7, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-yellow);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 3D Process Info */
        .process-info-3d {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            max-width: 300px;
            border: 1px solid var(--accent-yellow);
        }
        
        .process-info-3d h3 {
            color: var(--accent-yellow);
            margin-bottom: 10px;
        }
        
        /* 3D Control Panel */
        .control-panel-3d {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        
        .control-btn-3d {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-yellow);
            color: var(--dark-black);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .control-btn-3d:active {
            transform: scale(1.1);
        }
        
        /* Monitoring Cards */
        .monitoring-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .monitoring-card {
            background: rgba(51, 51, 51, 0.7);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .monitoring-card h4 {
            color: white;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .monitoring-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .monitoring-unit {
            color: var(--accent-light);
            font-size: 0.85rem;
        }
        
        /* Parameter Table */
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .parameter-table th, .parameter-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .parameter-table th {
            background: rgba(255, 193, 7, 0.2);
            color: var(--accent-yellow);
        }
        
        .parameter-table tr:active {
            background: rgba(255, 193, 7, 0.05);
        }
        
        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            min-height: 60px;
        }
        
        .alert-success {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid var(--secondary);
            color: #C8E6C9;
        }
        
        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid var(--accent-yellow);
            color: #FFF8E1;
        }
        
        .alert-danger {
            background: rgba(244, 67, 54, 0.2);
            border-left: 4px solid var(--danger);
            color: #FFCDD2;
        }
        
        /* Mobile-specific optimizations */
        .mobile-only {
            display: none;
        }
        
        .desktop-only {
            display: block;
        }
        
        /* Floating Action Button for Mobile */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
            display: none;
        }
        
        .fab {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-yellow), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-black);
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .fab:active {
            transform: scale(0.95);
        }
        
        /* Touch-friendly sliders */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-yellow);
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Better touch targets for inputs */
        input, select, textarea {
            font-size: 16px; /* Prevents zoom on iOS */
            min-height: 44px;
            padding: 10px;
        }
        
        /* Responsive Breakpoints */
        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
                padding: 25px 10px;
            }
            
            .logo-text, .user-info, .nav-item span {
                display: none;
            }
            
            .logo-icon {
                width: 40px;
                height: 40px;
                margin: 0 auto;
            }
            
            .main-content {
                margin-left: 80px;
                width: calc(100% - 80px);
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
            }
            
            .mobile-header {
                display: block;
            }
            
            .sidebar {
                width: 280px;
                transform: translateX(-100%);
                top: 0;
                padding-top: 80px;
            }
            
            .sidebar.mobile-visible {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 90px 15px 15px 15px;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
            }
            
            .top-bar h1 {
                font-size: 1.8rem;
            }
            
            .top-bar-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .chart-container {
                height: 280px;
                padding: 15px;
            }
            
            .dashboard-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .section-title {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }
            
            .bottle-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
            
            #pdamMap {
                height: 350px;
            }
            
            .process-visual-3d {
                height: 350px;
            }
            
            .process-container {
                gap: 20px;
            }
            
            .monitoring-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .fab-container {
                display: block;
            }
            
            .desktop-only {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .process-info-3d {
                max-width: 250px;
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .control-panel-3d {
                bottom: 10px;
                right: 10px;
                padding: 12px;
            }
            
            .control-btn-3d {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
            }
            
            .history-controls {
                flex-direction: column;
            }
            
            .history-controls .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .bottle-grid {
                grid-template-columns: 1fr;
            }
            
            .monitoring-cards {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .top-bar-controls {
                width: 100%;
            }
            
            .top-bar-controls .btn {
                flex: 1;
                min-width: 0;
            }
            
            #pdamMap {
                height: 300px;
            }
            
            .process-visual-3d {
                height: 300px;
            }
            
            .process-controls {
                padding: 20px;
            }
            
            .team-card {
                padding: 20px;
            }
            
            .team-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .history-table th, .history-table td {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }
        
        /* iPhone notch/padding adjustments */
        @supports (padding: max(0px)) {
            .main-content {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
            
            .fab-container {
                right: max(30px, env(safe-area-inset-right));
                bottom: max(30px, env(safe-area-inset-bottom));
            }
            
            .mobile-header {
                padding-top: max(15px, env(safe-area-inset-top));
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
        }
        
        /* iPad specific adjustments */
        @media (min-width: 768px) and (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bottle-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .team-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .monitoring-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Samsung Galaxy Fold and similar devices */
        @media (max-width: 320px) {
            .main-content {
                padding: 90px 10px 10px 10px;
            }
            
            .dashboard-section {
                padding: 15px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --dark-black: #000000;
                --mid-black: #111111;
                --light-black: #222222;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .btn, .stat-card, .dashboard-section {
                border-width: 2px;
            }
            
            .nav-item.active {
                border-left-width: 4px;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </div>
    
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">
                <div class="mobile-logo-icon">
                    <i class="fas fa-water"></i>
                </div>
                <div class="mobile-logo-text">
                    <h2>PDAM AI</h2>
                </div>
            </div>
            <div class="mobile-only">
                <div class="ai-status pulse-animation" style="display: flex; align-items: center; gap: 8px; background: rgba(255, 193, 7, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid var(--accent-yellow);">
                    <div style="width: 8px; height: 8px; background: var(--accent-yellow); border-radius: 50%;"></div>
                    <span style="font-size: 0.9rem;">AI: <strong id="mobileAiStatus">Aktif</strong></span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-water"></i>
                </div>
                <div class="logo-text">
                    <h2>PDAM AI</h2>
                    <p>Sistem Pengolahan Air</p>
                </div>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="showSection('dashboard'); closeMobileMenu();">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('process'); closeMobileMenu();">
                    <i class="fas fa-industry"></i>
                    <span>Proses Pengolahan</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('monitoring'); closeMobileMenu();">
                    <i class="fas fa-chart-line"></i>
                    <span>Monitoring</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('map'); closeMobileMenu();">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Peta PDAM</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('bottles'); closeMobileMenu();">
                    <i class="fas fa-wine-bottle"></i>
                    <span>Ukuran Botol</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('history'); closeMobileMenu();">
                    <i class="fas fa-history"></i>
                    <span>Histori Produksi</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('analytics'); closeMobileMenu();">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analitik</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('team'); closeMobileMenu();">
                    <i class="fas fa-users"></i>
                    <span>Tim Pengelola</span>
                </a>
            </nav>
            
            <!-- PROFIL RIDHO KURNIAWAN DI SIDEBAR -->
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="user-info">
                    <h4>Ridho Kurniawan</h4>
                    <p>CEO PDAM | NIM: 231011401209</p>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="main-content-wrapper">
                <div class="top-bar desktop-only">
                    <h1 id="sectionTitle">Dashboard Utama</h1>
                    <div class="top-bar-controls">
                        <div class="ai-status pulse-animation" style="display: flex; align-items: center; gap: 10px; background: rgba(255, 193, 7, 0.1); padding: 10px 20px; border-radius: 10px; border: 1px solid var(--accent-yellow);">
                            <div style="width: 10px; height: 10px; background: var(--accent-yellow); border-radius: 50%;"></div>
                            <span>Mode AI: <strong id="aiStatus">Aktif</strong></span>
                        </div>
                        <button class="btn" onclick="toggleAIMode()">
                            <i class="fas fa-robot"></i>
                            <span id="aiToggleText">Nonaktifkan AI</span>
                        </button>
                    </div>
                </div>
                
                <!-- Dashboard Content -->
                <div id="dashboardSection" class="dashboard-content active">
                    <!-- Dashboard Stats -->
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Produksi Hari Ini</h3>
                                <div class="stat-value" id="todayProduction">12,540 L</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>8.5% dari kemarin</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-filter"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Kualitas Air</h3>
                                <div class="stat-value" id="waterQuality">99.2%</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>2.1% lebih baik</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Efisiensi Energi</h3>
                                <div class="stat-value" id="energyEfficiency">87.5%</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>5.3% optimalisasi</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-recycle"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Penggunaan Kimia</h3>
                                <div class="stat-value" id="chemicalUsage">92.8%</div>
                                <div class="stat-change change-negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>3.2% lebih hemat</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-bolt"></i>
                            Aksi Cepat
                        </h2>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="startProduction()">
                                <i class="fas fa-play"></i>
                                <span>Mulai</span>
                            </button>
                            <button class="btn btn-warning" onclick="pauseProduction()">
                                <i class="fas fa-pause"></i>
                                <span>Jeda</span>
                            </button>
                            <button class="btn" onclick="showSection('bottles')">
                                <i class="fas fa-wine-bottle"></i>
                                <span>Botol</span>
                            </button>
                            <button class="btn btn-outline" onclick="exportDashboardPDF()">
                                <i class="fas fa-file-export"></i>
                                <span>Ekspor</span>
                            </button>
                            <button class="btn" onclick="simulateRealTimeData()">
                                <i class="fas fa-sync"></i>
                                <span>Simulasi</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recent Production -->
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-history"></i>
                            Produksi Terakhir
                        </h2>
                        <div class="history-table-container">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>ID Batch</th>
                                        <th>Tanggal</th>
                                        <th>Volume</th>
                                        <th>Kualitas</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentProduction">
                                    <!-- Data akan diisi JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- System Alerts -->
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Alert Sistem
                        </h2>
                        <div id="systemAlerts">
                            <!-- Alerts will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Process Section with 3D Visualization -->
                <div id="processSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-industry"></i>
                            Visualisasi 3D Proses Pengolahan Air
                        </h2>
                        
                        <div class="process-container">
                            <div class="process-visual-3d" id="processVisual3D">
                                <!-- 3D Canvas -->
                                <canvas id="process3D"></canvas>
                                
                                <!-- Info Panel -->
                                <div class="process-info-3d" id="processInfo3D">
                                    <h3>Intake</h3>
                                    <p>Air mentah dari sumber air masuk ke sistem</p>
                                    <p><strong>Status:</strong> <span style="color: #4CAF50;">Aktif</span></p>
                                    <p><strong>Flow:</strong> 120 L/detik</p>
                                </div>
                                
                                <!-- Control Panel -->
                                <div class="control-panel-3d">
                                    <div class="control-btn-3d" onclick="rotate3DView('left')">
                                        <i class="fas fa-arrow-left"></i>
                                    </div>
                                    <div class="control-btn-3d" onclick="rotate3DView('right')">
                                        <i class="fas fa-arrow-right"></i>
                                    </div>
                                    <div class="control-btn-3d" onclick="zoom3DView('in')">
                                        <i class="fas fa-search-plus"></i>
                                    </div>
                                    <div class="control-btn-3d" onclick="zoom3DView('out')">
                                        <i class="fas fa-search-minus"></i>
                                    </div>
                                    <div class="control-btn-3d" onclick="reset3DView()">
                                        <i class="fas fa-sync-alt"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="process-controls">
                                <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Kontrol Proses 3D</h3>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; color: #E0E0E0;">Kecepatan Animasi</label>
                                        <input type="range" min="0" max="10" value="5" class="slider" id="animationSpeed" onchange="updateAnimationSpeed(this.value)" style="width: 100%;">
                                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                            <span style="color: #BDBDBD;">Lambat</span>
                                            <span style="color: #BDBDBD;" id="animSpeedValue">Sedang (5x)</span>
                                            <span style="color: #BDBDBD;">Cepat</span>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; color: #E0E0E0;">Perspektif Tampilan</label>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                            <button class="btn" onclick="change3DView('top')" style="padding: 10px;">
                                                <i class="fas fa-eye"></i> Atas
                                            </button>
                                            <button class="btn" onclick="change3DView('side')" style="padding: 10px;">
                                                <i class="fas fa-eye"></i> Samping
                                            </button>
                                            <button class="btn" onclick="change3DView('front')" style="padding: 10px;">
                                                <i class="fas fa-eye"></i> Depan
                                            </button>
                                            <button class="btn" onclick="change3DView('perspective')" style="padding: 10px;">
                                                <i class="fas fa-eye"></i> 3D
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; color: #E0E0E0;">Parameter AI</label>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                            <div style="background: rgba(34, 34, 34, 0.5); padding: 10px; border-radius: 8px;">
                                                <small style="color: #BDBDBD;">Koagulan</small>
                                                <div style="font-weight: bold; color: var(--accent-yellow);" id="coagulantValue">30 mg/L</div>
                                                <input type="range" min="10" max="50" value="30" onchange="updateChemical('coagulant', this.value)" style="width: 100%; margin-top: 5px;">
                                            </div>
                                            <div style="background: rgba(34, 34, 34, 0.5); padding: 10px; border-radius: 8px;">
                                                <small style="color: #BDBDBD;">pH Target</small>
                                                <div style="font-weight: bold; color: var(--accent-yellow);" id="phValue">7.4  0.2</div>
                                                <input type="range" min="6" max="9" step="0.1" value="7.4" onchange="updateChemical('ph', this.value)" style="width: 100%; margin-top: 5px;">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;">
                                        <button class="btn" onclick="start3DProcess()">
                                            <i class="fas fa-play"></i> Mulai
                                        </button>
                                        <button class="btn btn-warning" onclick="pause3DProcess()">
                                            <i class="fas fa-pause"></i> Jeda
                                        </button>
                                        <button class="btn btn-danger" onclick="reset3DProcess()">
                                            <i class="fas fa-redo"></i> Reset
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Status Tahapan Proses 3D</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px;">
                                <div class="process-status" id="intakeStatus3D" style="border-left: 4px solid var(--secondary);">
                                    <i class="fas fa-water" style="color: var(--secondary); font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Intake</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Aktif</p>
                                </div>
                                <div class="process-status" id="coagulationStatus3D" style="border-left: 4px solid var(--accent-yellow);">
                                    <i class="fas fa-flask" style="color: var(--accent-yellow); font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Koagulasi</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Aktif</p>
                                </div>
                                <div class="process-status" id="sedimentationStatus3D" style="border-left: 4px solid var(--water-blue);">
                                    <i class="fas fa-tint" style="color: var(--water-blue); font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Sedimentasi</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Aktif</p>
                                </div>
                                <div class="process-status" id="filtrationStatus3D" style="border-left: 4px solid var(--secondary);">
                                    <i class="fas fa-filter" style="color: var(--secondary); font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Filtrasi</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Aktif</p>
                                </div>
                                <div class="process-status" id="disinfectionStatus3D" style="border-left: 4px solid var(--warning);">
                                    <i class="fas fa-spray-can" style="color: var(--warning); font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Desinfeksi</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Aktif</p>
                                </div>
                                <div class="process-status" id="distributionStatus3D" style="border-left: 4px solid #9C27B0;">
                                    <i class="fas fa-truck" style="color: #9C27B0; font-size: 1.3rem; margin-bottom: 8px;"></i>
                                    <h4 style="color: white; font-size: 0.9rem;">Distribusi</h4>
                                    <p style="color: var(--accent-light); font-size: 0.8rem;">Siap</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Process Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Proses</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportProcessPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportProcessCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Monitoring Section - LENGKAP -->
                <div id="monitoringSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-chart-line"></i>
                            Monitoring Real-time
                        </h2>
                        
                        <div class="monitoring-cards">
                            <div class="monitoring-card" style="border-left-color: var(--water-blue);">
                                <h4>Debit Air Masuk</h4>
                                <div class="monitoring-value" id="flowIn">120.5</div>
                                <div class="monitoring-unit">Liter/detik</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>Stabil</span>
                                </div>
                            </div>
                            
                            <div class="monitoring-card" style="border-left-color: var(--secondary);">
                                <h4>Tekanan Sistem</h4>
                                <div class="monitoring-value" id="systemPressure">2.45</div>
                                <div class="monitoring-unit">Bar</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Normal</span>
                                </div>
                            </div>
                            
                            <div class="monitoring-card" style="border-left-color: var(--accent-yellow);">
                                <h4>Tingkat Kekeruhan</h4>
                                <div class="monitoring-value" id="turbidity">2.1</div>
                                <div class="monitoring-unit">NTU</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>Menurun</span>
                                </div>
                            </div>
                            
                            <div class="monitoring-card" style="border-left-color: var(--warning);">
                                <h4>Suhu Air</h4>
                                <div class="monitoring-value" id="waterTemp">27.5</div>
                                <div class="monitoring-unit">C</div>
                                <div class="stat-change change-positive">
                                    <i class="fas fa-thermometer-half"></i>
                                    <span>Optimal</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Kualitas Air (Real-time)</h3>
                                <canvas id="qualityChart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Parameter Kimia</h3>
                                <canvas id="chemicalChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="charts-grid" style="margin-top: 25px;">
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Aliran Air (L/detik)</h3>
                                <canvas id="flowChart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Tekanan Sistem (Bar)</h3>
                                <canvas id="pressureChart"></canvas>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Parameter Utama</h3>
                            <div class="history-table-container">
                                <table class="parameter-table">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Nilai</th>
                                            <th>Unit</th>
                                            <th>Status</th>
                                            <th>Target</th>
                                        </tr>
                                    </thead>
                                    <tbody id="parameterTable">
                                        <!-- Data akan diisi JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Status Peralatan</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 15px; border-radius: 10px; border-left: 4px solid var(--secondary);">
                                    <h4 style="color: white; margin-bottom: 5px;">Pompa Intake</h4>
                                    <p style="color: var(--accent-light);">Status: <span style="color: var(--secondary);">Aktif</span></p>
                                    <p style="color: var(--accent-light); font-size: 0.9rem;">Flow: <span id="intakeFlow">120 L/detik</span></p>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 15px; border-radius: 10px; border-left: 4px solid var(--secondary);">
                                    <h4 style="color: white; margin-bottom: 5px;">Sistem Filtrasi</h4>
                                    <p style="color: var(--accent-light);">Status: <span style="color: var(--secondary);">Aktif</span></p>
                                    <p style="color: var(--accent-light); font-size: 0.9rem;">Pressure: <span id="filterPressure">2.5 Bar</span></p>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 15px; border-radius: 10px; border-left: 4px solid var(--warning);">
                                    <h4 style="color: white; margin-bottom: 5px;">Bak Sedimentasi</h4>
                                    <p style="color: var(--accent-light);">Status: <span style="color: var(--warning);">Pemeliharaan</span></p>
                                    <p style="color: var(--accent-light); font-size: 0.9rem;">Level: <span id="sedimentLevel">85%</span></p>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 15px; border-radius: 10px; border-left: 4px solid var(--secondary);">
                                    <h4 style="color: white; margin-bottom: 5px;">Sistem Desinfeksi</h4>
                                    <p style="color: var(--accent-light);">Status: <span style="color: var(--secondary);">Aktif</span></p>
                                    <p style="color: var(--accent-light); font-size: 0.9rem;">Chlorine: <span id="chlorineLevel">1.5 mg/L</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Monitoring Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Monitoring</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportMonitoringPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportMonitoringCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Map Section - DIPERBAIKI dengan Leaflet -->
                <div id="mapSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-map-marked-alt"></i>
                            Peta PDAM Indonesia
                        </h2>
                        
                        <div id="pdamMap">
                            <!-- Peta Leaflet akan ditampilkan di sini -->
                        </div>
                        
                        <!-- Legend Peta -->
                        <div class="map-legend">
                            <h4 style="color: var(--accent-yellow); margin-bottom: 10px; font-size: 0.9rem;">Legenda PDAM:</h4>
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <div style="width: 12px; height: 12px; background: #4CAF50; border-radius: 50%; margin-right: 8px;"></div>
                                <span style="color: white; font-size: 0.85rem;">Kualitas  98%</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <div style="width: 12px; height: 12px; background: #FF9800; border-radius: 50%; margin-right: 8px;"></div>
                                <span style="color: white; font-size: 0.85rem;">Kualitas 97-98%</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div style="width: 12px; height: 12px; background: #F44336; border-radius: 50%; margin-right: 8px;"></div>
                                <span style="color: white; font-size: 0.85rem;">Kualitas < 97%</span>
                            </div>
                        </div>
                        
                        <!-- Kontrol Peta -->
                        <div class="map-controls">
                            <button class="map-control-btn" onclick="zoomToIndonesia()">
                                <i class="fas fa-globe-asia"></i>
                                <span>Zoom Indonesia</span>
                            </button>
                            <button class="map-control-btn" onclick="zoomToAllMarkers()">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Lihat Semua PDAM</span>
                            </button>
                            <button class="map-control-btn" onclick="showAllInfo()">
                                <i class="fas fa-info-circle"></i>
                                <span>Info PDAM</span>
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Rekomendasi Pengolahan Berdasarkan Wilayah</h3>
                            <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: white;">Rekomendasi AI untuk PDAM Terpilih</h4>
                                    <button class="btn" onclick="generateRecommendation()">
                                        <i class="fas fa-robot"></i> Generate AI
                                    </button>
                                </div>
                                <div id="recommendations">
                                    <!-- Rekomendasi akan diisi JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Map Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Peta</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportMapPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportMapCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottles Section -->
                <div id="bottlesSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-wine-bottle"></i>
                            Pemilihan Ukuran Botol
                        </h2>
                        
                        <div class="bottle-grid">
                            <div class="bottle-card active" onclick="selectBottle(330)">
                                <div class="bottle-icon">
                                    <div class="bottle-body">
                                        <div class="bottle-water" style="height: 85%;"></div>
                                    </div>
                                    <div class="bottle-neck"></div>
                                    <div class="bottle-cap"></div>
                                </div>
                                <div class="bottle-info">
                                    <h3>330ml</h3>
                                    <p>Botol kecil untuk konsumsi personal</p>
                                    <p style="color: var(--accent-yellow); font-weight: bold; margin-top: 10px;">Rp 3.500/botol</p>
                                </div>
                            </div>
                            
                            <div class="bottle-card" onclick="selectBottle(600)">
                                <div class="bottle-icon">
                                    <div class="bottle-body">
                                        <div class="bottle-water" style="height: 90%;"></div>
                                    </div>
                                    <div class="bottle-neck"></div>
                                    <div class="bottle-cap"></div>
                                </div>
                                <div class="bottle-info">
                                    <h3>600ml</h3>
                                    <p>Ukuran standar untuk penjualan ritel</p>
                                    <p style="color: var(--accent-yellow); font-weight: bold; margin-top: 10px;">Rp 5.000/botol</p>
                                </div>
                            </div>
                            
                            <div class="bottle-card" onclick="selectBottle(1500)">
                                <div class="bottle-icon">
                                    <div class="bottle-body">
                                        <div class="bottle-water" style="height: 95%;"></div>
                                    </div>
                                    <div class="bottle-neck"></div>
                                    <div class="bottle-cap"></div>
                                </div>
                                <div class="bottle-info">
                                    <h3>1.5L</h3>
                                    <p>Botol keluarga untuk konsumsi harian</p>
                                    <p style="color: var(--accent-yellow); font-weight: bold; margin-top: 10px;">Rp 10.000/botol</p>
                                </div>
                            </div>
                            
                            <div class="bottle-card" onclick="selectBottle(5000)">
                                <div class="bottle-icon">
                                    <div class="bottle-body">
                                        <div class="bottle-water" style="height: 98%;"></div>
                                    </div>
                                    <div class="bottle-neck"></div>
                                    <div class="bottle-cap"></div>
                                </div>
                                <div class="bottle-info">
                                    <h3>5L</h3>
                                    <p>Botol besar untuk kantor & usaha</p>
                                    <p style="color: var(--accent-yellow); font-weight: bold; margin-top: 10px;">Rp 25.000/botol</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; background: rgba(51, 51, 51, 0.7); padding: 25px; border-radius: 15px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Kalkulasi Produksi</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
                                <div>
                                    <p style="color: #BDBDBD; margin-bottom: 8px;">Ukuran Botol Terpilih:</p>
                                    <p style="font-size: 1.3rem; font-weight: bold; color: var(--accent-yellow);" id="selectedBottleSize">330 ml</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; margin-bottom: 8px;">Jumlah Botol per Batch:</p>
                                    <p style="font-size: 1.3rem; font-weight: bold; color: var(--secondary);" id="bottlesPerBatch">3,030 botol</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; margin-bottom: 8px;">Estimasi Pendapatan:</p>
                                    <p style="font-size: 1.3rem; font-weight: bold; color: var(--secondary);" id="estimatedRevenue">Rp 10.605.000</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; margin-bottom: 8px;">Waktu Produksi:</p>
                                    <p style="font-size: 1.3rem; font-weight: bold; color: var(--accent-yellow);" id="productionTime">45 menit</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 8px; color: #BDBDBD;">Jumlah Batch</label>
                                    <input type="number" id="batchCount" value="1" min="1" max="10" style="width: 100%; padding: 12px; background: rgba(34, 34, 34, 0.5); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; color: white; font-size: 16px;" onchange="updateBatchCalculations()">
                                </div>
                                <div>
                                    <button class="btn" style="width: 100%;" onclick="calculateProductionPlan()">
                                        <i class="fas fa-calculator"></i> Hitung Rencana Produksi
                                    </button>
                                </div>
                            </div>
                            
                            <div id="productionPlan" style="margin-top: 20px; display: none; background: rgba(34, 34, 34, 0.5); padding: 15px; border-radius: 10px;">
                                <h4 style="color: var(--accent-yellow); margin-bottom: 10px;">Rencana Produksi</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                                    <div>
                                        <p style="color: #BDBDBD;">Total Botol:</p>
                                        <p style="color: white; font-weight: bold; font-size: 1.1rem;" id="totalBottles">0</p>
                                    </div>
                                    <div>
                                        <p style="color: #BDBDBD;">Total Pendapatan:</p>
                                        <p style="color: white; font-weight: bold; font-size: 1.1rem;" id="totalRevenue">Rp 0</p>
                                    </div>
                                    <div>
                                        <p style="color: #BDBDBD;">Total Waktu:</p>
                                        <p style="color: white; font-weight: bold; font-size: 1.1rem;" id="totalTime">0 menit</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Bottle Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Produksi</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportBottlePDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportBottleCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- History Section - LENGKAP -->
                <div id="historySection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-history"></i>
                            Histori Produksi & Statistik
                        </h2>
                        
                        <div class="history-controls">
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn" onclick="filterHistory('today')">
                                    <i class="fas fa-calendar-day"></i> Hari Ini
                                </button>
                                <button class="btn" onclick="filterHistory('week')">
                                    <i class="fas fa-calendar-week"></i> Minggu Ini
                                </button>
                                <button class="btn" onclick="filterHistory('month')">
                                    <i class="fas fa-calendar-alt"></i> Bulan Ini
                                </button>
                                <button class="btn" onclick="filterHistory('all')">
                                    <i class="fas fa-calendar"></i> Semua
                                </button>
                            </div>
                            
                            <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px;">
                                <button class="btn btn-outline" onclick="exportHistoryCSV()">
                                    <i class="fas fa-file-export"></i> Ekspor CSV
                                </button>
                                <button class="btn btn-outline" onclick="exportHistoryPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor PDF
                                </button>
                                <button class="btn btn-danger" onclick="clearHistory('today')">
                                    <i class="fas fa-trash"></i> Hapus Hari Ini
                                </button>
                                <button class="btn btn-danger" onclick="clearHistory('all')">
                                    <i class="fas fa-trash-alt"></i> Hapus Semua
                                </button>
                            </div>
                        </div>
                        
                        <div class="history-table-container">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>ID Batch</th>
                                        <th>Tanggal</th>
                                        <th>Volume (L)</th>
                                        <th>Ukuran Botol</th>
                                        <th>Kualitas</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTable">
                                    <!-- Data akan diisi JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Statistik Produksi</h3>
                            <div class="charts-grid">
                                <div class="chart-container">
                                    <h3 style="color: white; margin-bottom: 15px;">Volume Produksi (Mingguan)</h3>
                                    <canvas id="productionChart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <h3 style="color: white; margin-bottom: 15px;">Trend Kualitas Air</h3>
                                    <canvas id="qualityTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Ringkasan Produksi</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;">
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px; text-align: center;">
                                    <h4 style="color: #BDBDBD; margin-bottom: 10px; font-size: 0.9rem;">Total Produksi</h4>
                                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent-yellow);" id="totalProduction">50,240 L</div>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px; text-align: center;">
                                    <h4 style="color: #BDBDBD; margin-bottom: 10px; font-size: 0.9rem;">Rata-rata Kualitas</h4>
                                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--secondary);" id="avgQuality">98.9%</div>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px; text-align: center;">
                                    <h4 style="color: #BDBDBD; margin-bottom: 10px; font-size: 0.9rem;">Jumlah Batch</h4>
                                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--water-blue);" id="totalBatches">42</div>
                                </div>
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px; text-align: center;">
                                    <h4 style="color: #BDBDBD; margin-bottom: 10px; font-size: 0.9rem;">Efisiensi Rata-rata</h4>
                                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--warning);" id="avgEfficiency">86.5%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Section - LENGKAP -->
                <div id="analyticsSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            Analitik Lanjutan & AI Insights
                        </h2>
                        
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Trend Efisiensi Produksi</h3>
                                <canvas id="efficiencyChart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Prediksi Produksi 7 Hari</h3>
                                <canvas id="forecastChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="charts-grid" style="margin-top: 25px;">
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Konsumsi Kimia Per Batch</h3>
                                <canvas id="chemicalConsumptionChart"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <h3 style="color: white; margin-bottom: 20px;">Konsumsi Energi (kWh)</h3>
                                <canvas id="energyConsumptionChart"></canvas>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Analisis Kinerja</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px;">
                                    <h4 style="color: white; margin-bottom: 15px;">KPI Utama</h4>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">OEE (Overall Equipment Effectiveness)</span>
                                                <span style="color: var(--accent-yellow); font-weight: bold;">84.7%</span>
                                            </div>
                                            <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; margin-top: 5px;">
                                                <div style="width: 84.7%; height: 100%; background: var(--accent-yellow); border-radius: 4px;"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">MTBF (Mean Time Between Failure)</span>
                                                <span style="color: var(--secondary); font-weight: bold;">142 jam</span>
                                            </div>
                                            <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; margin-top: 5px;">
                                                <div style="width: 85%; height: 100%; background: var(--secondary); border-radius: 4px;"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">Yield Rate</span>
                                                <span style="color: var(--water-blue); font-weight: bold;">96.2%</span>
                                            </div>
                                            <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; margin-top: 5px;">
                                                <div style="width: 96.2%; height: 100%; background: var(--water-blue); border-radius: 4px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 10px;">
                                    <h4 style="color: white; margin-bottom: 15px;">Cost Analysis</h4>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">Cost per Liter</span>
                                                <span style="color: var(--accent-yellow); font-weight: bold;">Rp 450</span>
                                            </div>
                                            <div style="font-size: 0.8rem; color: var(--accent-light);">Berkurang 5.2% dari bulan lalu</div>
                                        </div>
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">Chemical Cost</span>
                                                <span style="color: var(--warning); font-weight: bold;">Rp 12.5 jt</span>
                                            </div>
                                            <div style="font-size: 0.8rem; color: var(--accent-light);">Berkurang 8.3% setelah optimasi AI</div>
                                        </div>
                                        <div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="color: #BDBDBD; font-size: 0.9rem;">Energy Cost</span>
                                                <span style="color: var(--secondary); font-weight: bold;">Rp 8.2 jt</span>
                                            </div>
                                            <div style="font-size: 0.8rem; color: var(--accent-light);">Berkurang 12.1% dengan schedule optimal</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Rekomendasi AI untuk Optimasi</h3>
                            <div style="background: rgba(255, 193, 7, 0.1); border-left: 4px solid var(--accent-yellow); padding: 20px; border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div style="width: 50px; height: 50px; background: var(--accent-yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-robot" style="color: var(--dark-black); font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h4 style="color: white;">AI Optimization Engine</h4>
                                        <p style="color: var(--accent-light); font-size: 0.9rem;">Sistem rekomendasi berbasis Machine Learning</p>
                                    </div>
                                </div>
                                
                                <div id="aiRecommendations">
                                    <!-- Rekomendasi AI akan diisi JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Analytics Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Analitik</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportAnalyticsPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportAnalyticsCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Team Section - LENGKAP -->
                <div id="teamSection" class="dashboard-content">
                    <div class="dashboard-section">
                        <h2 class="section-title">
                            <i class="fas fa-users"></i>
                            Tim Pengelola PDAM AI
                        </h2>
                        
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Struktur Organisasi</h3>
                            <div style="background: rgba(255, 193, 7, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--accent-yellow);">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--accent-yellow), var(--primary)); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-sitemap" style="color: var(--dark-black); font-size: 1.8rem;"></i>
                                    </div>
                                    <div>
                                        <h4 style="color: white;">Struktur Tim PDAM AI</h4>
                                        <p style="color: var(--accent-light); font-size: 0.9rem;">Dipimpin oleh Ridho Kurniawan (CEO) dengan 3 divisi utama: Operasional, Teknik, dan Data Science</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="team-grid">
                            <!-- Ridho Kurniawan - Admin -->
                            <div class="team-card">
                                <div class="team-avatar" style="background: linear-gradient(135deg, var(--accent-yellow), var(--primary)); border-color: var(--accent-yellow);">
                                    <i class="fas fa-user-tie" style="color: var(--dark-black);"></i>
                                </div>
                                <div class="team-info">
                                    <h3>Ridho Kurniawan</h3>
                                    <p style="color: var(--accent-yellow); font-weight: bold; margin-bottom: 5px;">CEO</p>
                                    <p style="color: var(--accent-light); margin-bottom: 15px; font-size: 0.9rem;">NIM: 231011401209</p>
                                    <p style="color: #BDBDBD; font-size: 0.85rem; margin-bottom: 15px;">Memimpin seluruh operasional PDAM AI, bertanggung jawab atas manajemen sistem, monitoring, dan pelaporan.</p>
                                    <div class="team-role" style="background: rgba(255, 193, 7, 0.2); color: var(--accent-yellow);">
                                        <i class="fas fa-star"></i> Kepala Admin
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tim Operasional -->
                            <div class="team-card">
                                <div class="team-avatar" style="background: linear-gradient(135deg, var(--secondary), #2E7D32); border-color: var(--secondary);">
                                    <i class="fas fa-cogs" style="color: white;"></i>
                                </div>
                                <div class="team-info">
                                    <h3>Tim Operasional</h3>
                                    <p style="color: var(--secondary); font-weight: bold; margin-bottom: 5px;">5 Anggota</p>
                                    <p style="color: var(--accent-light); margin-bottom: 15px; font-size: 0.9rem;">Shift 24/7</p>
                                    <p style="color: #BDBDBD; font-size: 0.85rem; margin-bottom: 15px;">Bertanggung jawab atas operasional harian sistem pengolahan air, monitoring real-time, dan quality control.</p>
                                    <div class="team-role" style="background: rgba(76, 175, 80, 0.2); color: var(--secondary);">
                                        <i class="fas fa-tools"></i> Operasional
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tim Teknik -->
                            <div class="team-card">
                                <div class="team-avatar" style="background: linear-gradient(135deg, var(--warning), #D84315); border-color: var(--warning);">
                                    <i class="fas fa-wrench" style="color: white;"></i>
                                </div>
                                <div class="team-info">
                                    <h3>Tim Teknik & Maintenance</h3>
                                    <p style="color: var(--warning); font-weight: bold; margin-bottom: 5px;">4 Anggota</p>
                                    <p style="color: var(--accent-light); margin-bottom: 15px; font-size: 0.9rem;">Specialist Equipment</p>
                                    <p style="color: #BDBDBD; font-size: 0.85rem; margin-bottom: 15px;">Bertanggung jawab atas perawatan dan perbaikan peralatan, kalibrasi sensor, dan preventive maintenance.</p>
                                    <div class="team-role" style="background: rgba(255, 87, 34, 0.2); color: var(--warning);">
                                        <i class="fas fa-hard-hat"></i> Teknik
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tim Data Science -->
                            <div class="team-card">
                                <div class="team-avatar" style="background: linear-gradient(135deg, #2196F3, #0D47A1); border-color: #2196F3;">
                                    <i class="fas fa-database" style="color: white;"></i>
                                </div>
                                <div class="team-info">
                                    <h3>Tim Data Science & AI</h3>
                                    <p style="color: #2196F3; font-weight: bold; margin-bottom: 5px;">3 Anggota</p>
                                    <p style="color: var(--accent-light); margin-bottom: 15px; font-size: 0.9rem;">AI & Analytics</p>
                                    <p style="color: #BDBDBD; font-size: 0.85rem; margin-bottom: 15px;">Mengembangkan sistem AI untuk optimasi produksi, predictive maintenance, dan analisis data real-time.</p>
                                    <div class="team-role" style="background: rgba(33, 150, 243, 0.2); color: #2196F3;">
                                        <i class="fas fa-brain"></i> Data Science
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 20px;">Kontak & Informasi Tim</h3>
                            <div style="background: rgba(51, 51, 51, 0.7); padding: 20px; border-radius: 15px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px;">
                                    <div>
                                        <h4 style="color: white; margin-bottom: 10px; font-size: 1rem;">Ridho Kurniawan</h4>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-id-card" style="color: var(--accent-yellow); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">NIM: 231011401209</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-envelope" style="color: var(--accent-yellow); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">ridho.kurniawan@pdam-ai.id</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-phone" style="color: var(--accent-yellow); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">+62 895 0793 2193</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 style="color: white; margin-bottom: 10px; font-size: 1rem;">Tim Operasional</h4>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-user" style="color: var(--secondary); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Koordinator: Ahmad Fauzi</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-envelope" style="color: var(--secondary); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">operasional@pdam-ai.id</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-clock" style="color: var(--secondary); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Shift: 24/7 Operation</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 style="color: white; margin-bottom: 10px; font-size: 1rem;">Tim Teknik</h4>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-user" style="color: var(--warning); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Koordinator: Erlangga</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-envelope" style="color: var(--warning); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">teknik@pdam-ai.id</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-wrench" style="color: var(--warning); font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Support: 08:00 - 20:00</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 style="color: white; margin-bottom: 10px; font-size: 1rem;">Tim Data Science</h4>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-user" style="color: #2196F3; font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Lead: Beliana</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-envelope" style="color: #2196F3; font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">data.science@pdam-ai.id</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <i class="fas fa-laptop-code" style="color: #2196F3; font-size: 0.9rem;"></i>
                                                <span style="color: var(--accent-light); font-size: 0.85rem;">Support: 09:00 - 17:00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Team Data -->
                        <div style="margin-top: 30px;">
                            <h3 style="color: var(--accent-yellow); margin-bottom: 15px;">Ekspor Data Tim</h3>
                            <div class="export-buttons">
                                <button class="export-btn pdf" onclick="exportTeamPDF()">
                                    <i class="fas fa-file-pdf"></i> Ekspor ke PDF
                                </button>
                                <button class="export-btn csv" onclick="exportTeamCSV()">
                                    <i class="fas fa-file-csv"></i> Ekspor ke CSV
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button for Mobile -->
    <div class="fab-container" id="fabContainer">
        <div class="fab" onclick="toggleMobileMenu()">
            <i class="fas fa-bars" id="fabIcon"></i>
        </div>
    </div>

    <script>
        // Mobile-specific variables
        let isMobileMenuOpen = false;
        let isMobile = window.innerWidth <= 768;
        
        // Data dan State Management
        let currentSection = 'dashboard';
        let isAIActive = true;
        let selectedBottleSize = 330;
        let productionHistory = [];
        let processInterval;
        let currentProcessStep = 0;
        let isProcessRunning = false;
        let processSpeed = 5;
        let charts = {};
        let realTimeInterval;
        let map = null;
        let leafletMarkers = [];
        
        // Three.js Variables
        let scene, camera, renderer, controls;
        let processObjects = [];
        let current3DStep = 0;
        let is3DProcessRunning = false;
        let animationSpeed = 5;
        
        // Monitoring Data
        let monitoringData = {
            flowIn: 120.5,
            systemPressure: 2.45,
            turbidity: 2.1,
            waterTemp: 27.5,
            parameters: [
                { name: "pH", value: 7.4, unit: "", status: "Optimal", target: "7.0-7.5" },
                { name: "Kekeruhan", value: 2.1, unit: "NTU", status: "Baik", target: "<5 NTU" },
                { name: "Klorin", value: 1.5, unit: "mg/L", status: "Optimal", target: "1.0-2.0 mg/L" },
                { name: "Konduktivitas", value: 450, unit: "S/cm", status: "Normal", target: "<500 S/cm" },
                { name: "TDS", value: 225, unit: "mg/L", status: "Baik", target: "<250 mg/L" },
                { name: "Suhu", value: 27.5, unit: "C", status: "Optimal", target: "25-30C" }
            ]
        };
        
        // PDAM Data untuk Peta
        const pdamData = [
            { 
                name: "PDAM DKI Jakarta", 
                lat: -6.2088, 
                lng: 106.8456, 
                capacity: 5000, 
                quality: 98.5, 
                issues: ["Tingginya sedimentasi", "Kebutuhan koagulan tinggi"], 
                recommendation: "Tingkatkan pre-treatment dan optimasi koagulan",
                address: "Jl. Pejompongan Raya No.2, Jakarta Pusat",
                phone: "(021) 570-4545",
                icon: "fa-water"
            },
            { 
                name: "PDAM Bandung", 
                lat: -6.9175, 
                lng: 107.6191, 
                capacity: 2500, 
                quality: 97.2, 
                issues: ["pH fluktuatif", "Kandungan besi tinggi"], 
                recommendation: "Penambahan aerasi dan pH adjustment",
                address: "Jl. Badak Singa No.10, Bandung",
                phone: "(022) 423-1923",
                icon: "fa-tint"
            },
            { 
                name: "PDAM Surabaya", 
                lat: -7.2575, 
                lng: 112.7521, 
                capacity: 4000, 
                quality: 99.1, 
                issues: ["Klorinasi berlebih", "Biaya operasional tinggi"], 
                recommendation: "Optimasi dosis klorin dengan sistem kontrol AI",
                address: "Jl. Raya Darmo No.46, Surabaya",
                phone: "(031) 567-8901",
                icon: "fa-filter"
            },
            { 
                name: "PDAM Medan", 
                lat: 3.5952, 
                lng: 98.6722, 
                capacity: 3200, 
                quality: 96.8, 
                issues: ["Kekeruhan tinggi", "Kapasitas terbatas"], 
                recommendation: "Upgrade sistem filtrasi dan tambah kapasitas",
                address: "Jl. Sisingamangaraja No.1, Medan",
                phone: "(061) 453-2211",
                icon: "fa-water-tower"
            },
            { 
                name: "PDAM Bali", 
                lat: -8.4095, 
                lng: 115.1889, 
                capacity: 1800, 
                quality: 98.9, 
                issues: ["Musim kemarau", "Tekanan rendah"], 
                recommendation: "Sistem booster pump dan water storage",
                address: "Jl. Gatot Subroto IV No.5, Denpasar",
                phone: "(0361) 223-445",
                icon: "fa-umbrella-beach"
            }
        ];

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            loadProductionHistory();
            updateRecentProduction();
            initAllCharts();
            updateBottleCalculations();
            showSection('dashboard');
            startRealTimeUpdates();
            updateMonitoringData();
            generateAIRecommendations();
            updateParameterTable();
            updateSystemAlerts();
            
            // Inisialisasi mobile features
            if (isMobile) {
                document.getElementById('fabContainer').style.display = 'block';
                updateMobileAIStatus();
            }
            
            // Inisialisasi peta
            initLeafletMap();
            
            // Tambahkan event listeners untuk touch
            setupTouchEvents();
        });
        
        // ========== MOBILE FUNCTIONS ==========
        
        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const fabIcon = document.getElementById('fabIcon');
            
            if (isMobileMenuOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }
        
        function openMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const fabIcon = document.getElementById('fabIcon');
            
            sidebar.classList.add('mobile-visible');
            fabIcon.className = 'fas fa-times';
            isMobileMenuOpen = true;
            
            // Add overlay
            const overlay = document.createElement('div');
            overlay.id = 'mobileOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                z-index: 99;
                backdrop-filter: blur(5px);
            `;
            overlay.onclick = closeMobileMenu;
            document.body.appendChild(overlay);
        }
        
        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const fabIcon = document.getElementById('fabIcon');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.remove('mobile-visible');
            fabIcon.className = 'fas fa-bars';
            isMobileMenuOpen = false;
            
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Update mobile detection on resize
        window.addEventListener('resize', function() {
            isMobile = window.innerWidth <= 768;
            if (!isMobile && isMobileMenuOpen) {
                closeMobileMenu();
            }
            
            // Update FAB visibility
            document.getElementById('fabContainer').style.display = isMobile ? 'block' : 'none';
        });
        
        // Update AI status on mobile
        function updateMobileAIStatus() {
            document.getElementById('mobileAiStatus').textContent = 
                document.getElementById('aiStatus').textContent;
        }
        
        // Setup touch events for better mobile experience
        function setupTouchEvents() {
            // Prevent zoom on double-tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Add touch feedback for buttons
            document.querySelectorAll('.btn, .nav-item, .bottle-card, .team-card, .stat-card').forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.style.opacity = '0.8';
                });
                
                element.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                });
            });
            
            // Handle orientation change
            window.addEventListener('orientationchange', function() {
                setTimeout(function() {
                    if (window.innerWidth <= 768) {
                        closeMobileMenu();
                    }
                }, 300);
            });
        }
        
        // Override the original toggleAIMode to update mobile status
        const originalToggleAIMode = window.toggleAIMode;
        window.toggleAIMode = function() {
            originalToggleAIMode();
            updateMobileAIStatus();
        };
        
        // Show notification optimized for mobile
        function showMobileNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                right: 20px;
                padding: 15px;
                background: ${type === 'success' ? 'rgba(76, 175, 80, 0.95)' : 
                           type === 'warning' ? 'rgba(255, 87, 34, 0.95)' : 
                           type === 'danger' ? 'rgba(244, 67, 54, 0.95)' : 'rgba(255, 152, 0, 0.95)'};
                color: white;
                border-radius: 10px;
                z-index: 1000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                text-align: center;
                backdrop-filter: blur(10px);
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                      type === 'warning' ? 'exclamation-triangle' : 
                                      type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Override showNotification for mobile
        window.showNotification = function(message, type) {
            if (isMobile) {
                showMobileNotification(message, type);
            } else {
                // Use original desktop notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 
                               type === 'warning' ? 'rgba(255, 87, 34, 0.9)' : 
                               type === 'danger' ? 'rgba(244, 67, 54, 0.9)' : 'rgba(255, 152, 0, 0.9)'};
                    color: white;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    max-width: 400px;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                          type === 'warning' ? 'exclamation-triangle' : 
                                          type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        };
        
        // ========== FUNGSI UTAMA ==========
        
        // Fungsi untuk menampilkan section tertentu
        function showSection(sectionId) {
            // Sembunyikan semua section
            document.querySelectorAll('.dashboard-content').forEach(section => {
                section.classList.remove('active');
            });
            
            // Tampilkan section yang dipilih
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Cari nav item yang sesuai
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(sectionId)) {
                    item.classList.add('active');
                }
            });
            
            // Update section title
            const titles = {
                'dashboard': 'Dashboard Utama',
                'process': 'Proses Pengolahan 3D',
                'monitoring': 'Monitoring Real-time',
                'map': 'Peta PDAM',
                'bottles': 'Pemilihan Ukuran Botol',
                'history': 'Histori Produksi',
                'analytics': 'Analitik Lanjutan',
                'team': 'Tim Pengelola PDAM AI'
            };
            
            if (titles[sectionId]) {
                document.getElementById('sectionTitle').textContent = titles[sectionId];
            }
            
            currentSection = sectionId;
            
            // Jika section map, refresh peta
            if (sectionId === 'map') {
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize();
                    }
                }, 100);
            }
            
            // Jika section process, init 3D visualization
            if (sectionId === 'process') {
                setTimeout(() => {
                    init3DProcessVisualization();
                }, 100);
            }
            
            // Scroll ke atas saat berpindah section
            document.querySelector('.main-content').scrollTop = 0;
            
            // Tutup menu mobile jika terbuka
            if (isMobileMenuOpen) {
                closeMobileMenu();
            }
        }
        
        // Fungsi toggle AI Mode
        function toggleAIMode() {
            isAIActive = !isAIActive;
            document.getElementById('aiStatus').textContent = isAIActive ? 'Aktif' : 'Nonaktif';
            document.getElementById('aiToggleText').textContent = isAIActive ? 'Nonaktifkan AI' : 'Aktifkan AI';
            
            // Update status indicator
            const statusIndicator = document.querySelector('.ai-status');
            if (isAIActive) {
                statusIndicator.classList.add('pulse-animation');
                showNotification('Mode AI diaktifkan. Sistem berjalan dengan optimasi cerdas.', 'success');
                generateAIRecommendations();
            } else {
                statusIndicator.classList.remove('pulse-animation');
                showNotification('Mode AI dinonaktifkan. Sistem berjalan manual.', 'warning');
            }
        }
        
        // ========== LEAFLET MAP FUNCTIONS ==========
        
        function initLeafletMap() {
            const mapContainer = document.getElementById('pdamMap');
            if (!mapContainer) return;
            
            // Initialize map
            map = L.map('pdamMap').setView([-2.5489, 118.0149], 5);
            
            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Add dark theme tile layer (optional)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: ' OpenStreetMap,  CartoDB',
                maxZoom: 19
            }).addTo(map);
            
            // Add PDAM markers
            addLeafletMarkers();
            
            // Update recommendations
            updateRecommendations();
            
            // Add layer control
            addLayerControls();
        }
        
        function addLeafletMarkers() {
            leafletMarkers = [];
            
            // Create custom icon colors based on quality
            function getIconColor(quality) {
                if (quality >= 98) return 'green';
                if (quality >= 97) return 'orange';
                return 'red';
            }
            
            // Create custom icon
            function createPDAMIcon(quality) {
                const color = getIconColor(quality);
                return L.divIcon({
                    className: 'custom-pdam-icon',
                    html: `<div style="
                        width: 30px;
                        height: 30px;
                        background: ${color};
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.5);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 14px;
                    ">
                        <i class="fas fa-water"></i>
                    </div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
            }
            
            // Add markers for each PDAM
            pdamData.forEach(pdam => {
                const marker = L.marker([pdam.lat, pdam.lng], {
                    icon: createPDAMIcon(pdam.quality),
                    title: pdam.name
                }).addTo(map);
                
                // Create popup content
                const popupContent = `
                    <div style="color: #333; font-family: 'Inter', sans-serif; max-width: 300px;">
                        <div style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0); padding: 15px; border-radius: 10px;">
                            <h3 style="color: var(--accent-yellow); margin: 0 0 10px 0; font-size: 1.2rem; background: linear-gradient(to right, var(--accent-yellow), var(--primary)); -webkit-background-clip: text; background-clip: text; color: transparent;">${pdam.name}</h3>
                            <p style="margin: 5px 0; color: #555;">
                                <i class="fas fa-map-marker-alt" style="color: var(--accent-yellow); margin-right: 5px;"></i>
                                ${pdam.address}
                            </p>
                            <p style="margin: 5px 0; color: #555;">
                                <i class="fas fa-phone" style="color: var(--accent-yellow); margin-right: 5px;"></i>
                                ${pdam.phone}
                            </p>
                            <p style="margin: 5px 0; color: #555;">
                                <i class="fas fa-tint" style="color: var(--accent-yellow); margin-right: 5px;"></i>
                                Kapasitas: <strong>${pdam.capacity.toLocaleString()} L/detik</strong>
                            </p>
                            <p style="margin: 5px 0; color: #555;">
                                <i class="fas fa-chart-line" style="color: var(--accent-yellow); margin-right: 5px;"></i>
                                Kualitas: <strong style="color: ${pdam.quality >= 98 ? '#4CAF50' : pdam.quality >= 97 ? '#FF9800' : '#F44336'}">${pdam.quality}%</strong>
                            </p>
                            <div style="margin-top: 10px; padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 5px;">
                                <small style="color: #666; display: block; margin-bottom: 5px;">Rekomendasi AI:</small>
                                <p style="color: #444; font-size: 0.9rem; margin: 0;">${pdam.recommendation}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                
                // Add click event
                marker.on('click', function() {
                    showNotification(`PDAM ${pdam.name} dipilih`, 'info');
                });
                
                leafletMarkers.push({ marker, pdam });
            });
            
            // Fit bounds to show all markers
            if (leafletMarkers.length > 0) {
                const group = new L.featureGroup(leafletMarkers.map(m => m.marker));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        function addLayerControls() {
            // Add scale control
            L.control.scale().addTo(map);
            
            // Add zoom control
            L.control.zoom({
                position: 'topright'
            }).addTo(map);
        }
        
        function zoomToIndonesia() {
            map.setView([-2.5489, 118.0149], 5);
            showNotification('Zoom ke seluruh Indonesia', 'info');
        }
        
        function zoomToAllMarkers() {
            if (leafletMarkers.length > 0) {
                const group = new L.featureGroup(leafletMarkers.map(m => m.marker));
                map.fitBounds(group.getBounds().pad(0.1));
                showNotification('Menampilkan semua PDAM', 'info');
            }
        }
        
        function showAllInfo() {
            let info = "Informasi PDAM:\n";
            pdamData.forEach(pdam => {
                info += `\n${pdam.name} - Kualitas: ${pdam.quality}%`;
            });
            showNotification('Informasi PDAM ditampilkan di rekomendasi', 'info');
        }
        
        function updateRecommendations() {
            const container = document.getElementById('recommendations');
            if (!container) return;
            
            container.innerHTML = '';
            
            pdamData.forEach(pdam => {
                const qualityColor = pdam.quality >= 98 ? '#4CAF50' : 
                                   pdam.quality >= 97 ? '#FF9800' : '#F44336';
                
                const recElement = document.createElement('div');
                recElement.style.cssText = 'background: rgba(34, 34, 34, 0.5); padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid ' + qualityColor + ';';
                recElement.innerHTML = `
                    <h4 style="color: white; margin-bottom: 5px; font-size: 1rem;">${pdam.name}</h4>
                    <p style="color: var(--accent-light); margin-bottom: 5px; font-size: 0.9rem;">${pdam.recommendation}</p>
                    <div style="display: flex; justify-content: space-between; color: #BDBDBD; font-size: 0.85rem;">
                        <span>Kualitas: <span style="color: ${qualityColor}">${pdam.quality}%</span></span>
                        <span>Priority: <span style="color: ${pdam.quality < 97 ? '#F44336' : pdam.quality < 98 ? '#FF9800' : '#4CAF50'}">${pdam.quality < 97 ? 'TINGGI' : pdam.quality < 98 ? 'SEDANG' : 'RENDAH'}</span></span>
                    </div>
                `;
                container.appendChild(recElement);
            });
        }
        
        function generateRecommendation() {
            showNotification('AI sedang menganalisis dan menghasilkan rekomendasi...', 'info');
            
            setTimeout(() => {
                // Add random recommendation
                const recommendations = [
                    "Optimasi dosis koagulan berdasarkan data real-time",
                    "Penjadwalan pompa untuk efisiensi energi",
                    "Prediksi maintenance berdasarkan analisis trend",
                    "Adjustment pH otomatis berdasarkan input sensor"
                ];
                
                const randomRec = recommendations[Math.floor(Math.random() * recommendations.length)];
                
                const recElement = document.createElement('div');
                recElement.style.cssText = 'background: rgba(255, 193, 7, 0.1); padding: 12px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid var(--accent-yellow);';
                recElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 24px; height: 24px; background: var(--accent-yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-robot" style="color: var(--dark-black); font-size: 0.8rem;"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="color: var(--accent-yellow); margin-bottom: 5px; font-size: 0.95rem;">Rekomendasi AI Baru</h4>
                            <p style="color: var(--accent-light); margin-bottom: 5px; font-size: 0.85rem;">${randomRec}</p>
                            <span style="color: var(--accent-yellow); font-size: 0.8rem; font-weight: bold;">Generated: ${new Date().toLocaleTimeString('id-ID')}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('recommendations').prepend(recElement);
                showNotification('Rekomendasi AI berhasil dihasilkan!', 'success');
            }, 1500);
        }
        
        // ========== 3D PROCESS VISUALIZATION ==========
        
        function init3DProcessVisualization() {
            const container = document.getElementById('process3D');
            if (!container) return;
            
            // Hapus renderer sebelumnya jika ada
            if (renderer) {
                renderer.dispose();
            }
            
            // Inisialisasi scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            
            // Inisialisasi camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 10, 15);
            
            // Inisialisasi renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, canvas: container });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // Tambahkan lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            scene.add(directionalLight);
            
            // Buat sistem pengolahan air 3D sederhana
            create3DWaterTreatmentSystem();
            
            // Start animation loop
            animate3D();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
        }
        
        function create3DWaterTreatmentSystem() {
            // Hapus objek lama jika ada
            processObjects.forEach(obj => scene.remove(obj));
            processObjects = [];
            
            // Buat tank untuk setiap step proses
            const steps = [
                { name: 'Intake', color: 0x4CAF50, position: { x: -8, y: 0, z: 0 } },
                { name: 'Coagulation', color: 0xFFC107, position: { x: -4.8, y: 0, z: 0 } },
                { name: 'Sedimentation', color: 0x2196F3, position: { x: -1.6, y: 0, z: 0 } },
                { name: 'Filtration', color: 0x4CAF50, position: { x: 1.6, y: 0, z: 0 } },
                { name: 'Disinfection', color: 0xFF5722, position: { x: 4.8, y: 0, z: 0 } },
                { name: 'Distribution', color: 0x9C27B0, position: { x: 8, y: 0, z: 0 } }
            ];
            
            steps.forEach((step, index) => {
                // Buat tank
                const tankGeometry = new THREE.CylinderGeometry(0.8, 0.8, 2, 32);
                const tankMaterial = new THREE.MeshPhongMaterial({ 
                    color: step.color,
                    transparent: true,
                    opacity: 0.7
                });
                const tank = new THREE.Mesh(tankGeometry, tankMaterial);
                tank.position.set(step.position.x, step.position.y + 1, step.position.z);
                
                scene.add(tank);
                processObjects.push(tank);
            });
        }
        
        function animate3D() {
            requestAnimationFrame(animate3D);
            
            // Animate active step
            if (is3DProcessRunning) {
                // Rotasi ringan untuk efek hidup
                processObjects.forEach((obj, index) => {
                    if (index <= current3DStep) {
                        obj.rotation.y += 0.01;
                    }
                });
            }
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        function onWindowResize() {
            const container = document.getElementById('process3D');
            if (!container || !camera || !renderer) return;
            
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function start3DProcess() {
            if (is3DProcessRunning) return;
            
            is3DProcessRunning = true;
            current3DStep = 0;
            
            showNotification('Proses pengolahan 3D dimulai!', 'success');
            
            // Update process steps
            update3DProcessSteps();
        }
        
        function pause3DProcess() {
            is3DProcessRunning = false;
            showNotification('Proses 3D dijeda.', 'warning');
        }
        
        function reset3DProcess() {
            is3DProcessRunning = false;
            current3DStep = 0;
            
            // Reset rotation
            processObjects.forEach(obj => {
                obj.rotation.y = 0;
            });
            
            update3DProcessSteps();
            showNotification('Proses 3D direset.', 'info');
        }
        
        function update3DProcessSteps() {
            const steps = ['Intake', 'Coagulation', 'Sedimentation', 'Filtration', 'Disinfection', 'Distribution'];
            
            // Update UI status
            steps.forEach((step, index) => {
                const statusElement = document.getElementById(step.toLowerCase() + 'Status3D');
                if (statusElement) {
                    const statusP = statusElement.querySelector('p');
                    if (statusP) {
                        if (index <= current3DStep) {
                            statusP.innerHTML = '<span style="color: #4CAF50;">Aktif</span>';
                            statusElement.style.borderLeftColor = '#4CAF50';
                        } else {
                            statusP.innerHTML = '<span style="color: #FF9800;">Menunggu</span>';
                            statusElement.style.borderLeftColor = '#FF9800';
                        }
                    }
                }
            });
            
            // Update info panel
            const infoPanel = document.getElementById('processInfo3D');
            if (infoPanel && steps[current3DStep]) {
                const stepInfo = {
                    'Intake': { desc: 'Air mentah dari sumber air masuk ke sistem', flow: '120 L/detik' },
                    'Coagulation': { desc: 'Penambahan koagulan untuk menggumpalkan kotoran', flow: '115 L/detik' },
                    'Sedimentation': { desc: 'Pengendapan partikel berat', flow: '110 L/detik' },
                    'Filtration': { desc: 'Penyaringan melalui media filter', flow: '105 L/detik' },
                    'Disinfection': { desc: 'Penambahan klorin untuk membunuh bakteri', flow: '100 L/detik' },
                    'Distribution': { desc: 'Air bersih siap didistribusikan', flow: '95 L/detik' }
                };
                
                const info = stepInfo[steps[current3DStep]] || { desc: '', flow: '' };
                
                infoPanel.innerHTML = `
                    <h3>${steps[current3DStep]}</h3>
                    <p>${info.desc}</p>
                    <p><strong>Status:</strong> <span style="color: #4CAF50;">Aktif</span></p>
                    <p><strong>Flow:</strong> ${info.flow}</p>
                `;
            }
            
            // Move to next step
            if (is3DProcessRunning) {
                setTimeout(() => {
                    if (current3DStep < steps.length - 1) {
                        current3DStep++;
                        update3DProcessSteps();
                    } else {
                        // Restart process
                        current3DStep = 0;
                        update3DProcessSteps();
                    }
                }, 2000 / animationSpeed);
            }
        }
        
        function updateAnimationSpeed(value) {
            animationSpeed = value;
            document.getElementById('animSpeedValue').textContent = 
                value <= 3 ? 'Lambat (' + value + 'x)' : 
                value <= 7 ? 'Sedang (' + value + 'x)' : 
                'Cepat (' + value + 'x)';
        }
        
        function change3DView(view) {
            if (!camera) return;
            
            switch(view) {
                case 'top':
                    camera.position.set(0, 20, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'side':
                    camera.position.set(20, 5, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'front':
                    camera.position.set(0, 5, 20);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'perspective':
                    camera.position.set(10, 10, 15);
                    camera.lookAt(0, 0, 0);
                    break;
            }
            
            showNotification('Tampilan diubah ke ' + view, 'info');
        }
        
        function rotate3DView(direction) {
            if (!camera) return;
            
            if (direction === 'left') {
                camera.position.x -= 2;
            } else if (direction === 'right') {
                camera.position.x += 2;
            }
            
            camera.lookAt(0, 0, 0);
        }
        
        function zoom3DView(action) {
            if (!camera) return;
            
            if (action === 'in') {
                camera.position.multiplyScalar(0.9);
            } else if (action === 'out') {
                camera.position.multiplyScalar(1.1);
            }
            
            camera.lookAt(0, 0, 0);
        }
        
        function reset3DView() {
            if (!camera) return;
            
            camera.position.set(10, 10, 15);
            camera.lookAt(0, 0, 0);
            showNotification('Tampilan 3D direset', 'info');
        }
        
        // ========== FUNGSI MONITORING ==========
        
        function updateMonitoringData() {
            // Update monitoring cards
            document.getElementById('flowIn').textContent = monitoringData.flowIn.toFixed(1);
            document.getElementById('systemPressure').textContent = monitoringData.systemPressure.toFixed(2);
            document.getElementById('turbidity').textContent = monitoringData.turbidity.toFixed(1);
            document.getElementById('waterTemp').textContent = monitoringData.waterTemp.toFixed(1);
            
            // Update equipment status
            document.getElementById('intakeFlow').textContent = monitoringData.flowIn.toFixed(1) + ' L/detik';
            document.getElementById('filterPressure').textContent = monitoringData.systemPressure.toFixed(2) + ' Bar';
            document.getElementById('sedimentLevel').textContent = '85%';
            document.getElementById('chlorineLevel').textContent = '1.5 mg/L';
            
            // Update main stats
            document.getElementById('todayProduction').textContent = 
                (12540 + Math.random() * 500 - 250).toFixed(0) + ' L';
            document.getElementById('waterQuality').textContent = 
                (99.2 + Math.random() * 0.1 - 0.05).toFixed(1) + '%';
            document.getElementById('energyEfficiency').textContent = 
                (87.5 + Math.random() * 0.5 - 0.25).toFixed(1) + '%';
        }
        
        function updateParameterTable() {
            const tableBody = document.getElementById('parameterTable');
            tableBody.innerHTML = '';
            
            monitoringData.parameters.forEach(param => {
                const row = document.createElement('tr');
                const statusColor = param.status === 'Optimal' ? '#4CAF50' : 
                                  param.status === 'Baik' ? '#8BC34A' : 
                                  param.status === 'Normal' ? '#FFC107' : '#F44336';
                
                row.innerHTML = `
                    <td>${param.name}</td>
                    <td>${param.value} ${param.unit}</td>
                    <td>${param.unit || '-'}</td>
                    <td><span style="color: ${statusColor}">${param.status}</span></td>
                    <td>${param.target}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateSystemAlerts() {
            const alertsContainer = document.getElementById('systemAlerts');
            alertsContainer.innerHTML = '';
            
            const alerts = [
                { type: 'success', message: 'Semua sistem beroperasi normal', icon: 'fa-check-circle' },
                { type: 'warning', message: 'Bak sedimentasi membutuhkan pemeliharaan dalam 3 hari', icon: 'fa-exclamation-triangle' },
                { type: 'info', message: 'Optimasi AI sedang berjalan untuk efisiensi energi', icon: 'fa-robot' }
            ];
            
            alerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = `alert alert-${alert.type}`;
                alertElement.innerHTML = `
                    <i class="fas ${alert.icon}"></i>
                    <span>${alert.message}</span>
                `;
                alertsContainer.appendChild(alertElement);
            });
        }
        
        function startRealTimeUpdates() {
            if (realTimeInterval) clearInterval(realTimeInterval);
            
            realTimeInterval = setInterval(() => {
                if (currentSection === 'monitoring' || currentSection === 'dashboard') {
                    // Update monitoring data dengan sedikit variasi
                    monitoringData.flowIn += (Math.random() - 0.5) * 0.2;
                    monitoringData.systemPressure += (Math.random() - 0.5) * 0.05;
                    monitoringData.turbidity += (Math.random() - 0.5) * 0.1;
                    monitoringData.waterTemp += (Math.random() - 0.5) * 0.1;
                    
                    // Batasi nilai
                    monitoringData.flowIn = Math.max(115, Math.min(125, monitoringData.flowIn));
                    monitoringData.systemPressure = Math.max(2.3, Math.min(2.6, monitoringData.systemPressure));
                    monitoringData.turbidity = Math.max(1.5, Math.min(2.5, monitoringData.turbidity));
                    monitoringData.waterTemp = Math.max(26, Math.min(29, monitoringData.waterTemp));
                    
                    updateMonitoringData();
                    
                    // Update charts jika ada
                    if (charts.qualityChart) {
                        updateChartData();
                    }
                }
            }, 3000);
        }
        
        // ========== FUNGSI CHART ==========
        
        function initAllCharts() {
            initQualityChart();
            initChemicalChart();
            initFlowChart();
            initPressureChart();
            initProductionChart();
            initQualityTrendChart();
            initEfficiencyChart();
            initForecastChart();
            initChemicalConsumptionChart();
            initEnergyConsumptionChart();
        }
        
        function initQualityChart() {
            const ctx = document.getElementById('qualityChart').getContext('2d');
            charts.qualityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Kualitas Air (%)',
                        data: [98.5, 98.7, 99.1, 99.2, 99.0, 99.2],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initChemicalChart() {
            const ctx = document.getElementById('chemicalChart').getContext('2d');
            charts.chemicalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Koagulan', 'Klorin', 'Flokulan', 'pH+', 'pH-'],
                    datasets: [{
                        label: 'Penggunaan (mg/L)',
                        data: [30, 1.5, 5, 2.1, 0.5],
                        backgroundColor: [
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(76, 175, 80, 0.7)',
                            'rgba(33, 150, 243, 0.7)',
                            'rgba(255, 87, 34, 0.7)',
                            'rgba(156, 39, 176, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initFlowChart() {
            const ctx = document.getElementById('flowChart').getContext('2d');
            charts.flowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: 'Aliran Air (L/detik)',
                        data: [120, 121, 119, 122, 120, 121, 123, 120, 119, 120],
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initPressureChart() {
            const ctx = document.getElementById('pressureChart').getContext('2d');
            charts.pressureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: 'Tekanan (Bar)',
                        data: [2.4, 2.5, 2.45, 2.5, 2.48, 2.52, 2.5, 2.47, 2.51, 2.49],
                        borderColor: '#FF5722',
                        backgroundColor: 'rgba(255, 87, 34, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initProductionChart() {
            const ctx = document.getElementById('productionChart').getContext('2d');
            charts.productionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                    datasets: [{
                        label: 'Volume Produksi (L)',
                        data: [12450, 12630, 12380, 12750, 12890, 12240, 12050],
                        backgroundColor: 'rgba(255, 193, 7, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initQualityTrendChart() {
            const ctx = document.getElementById('qualityTrendChart').getContext('2d');
            charts.qualityTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Minggu 1', 'Minggu 2', 'Minggu 3', 'Minggu 4'],
                    datasets: [{
                        label: 'Kualitas Air (%)',
                        data: [98.5, 98.8, 99.0, 99.2],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initEfficiencyChart() {
            const ctx = document.getElementById('efficiencyChart').getContext('2d');
            charts.efficiencyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Efisiensi Energi (%)',
                        data: [82, 84, 85, 86, 87, 87.5],
                        borderColor: '#FFC107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initForecastChart() {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            charts.forecastChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['H+1', 'H+2', 'H+3', 'H+4', 'H+5', 'H+6', 'H+7'],
                    datasets: [{
                        label: 'Prediksi Produksi (L)',
                        data: [12500, 12650, 12780, 12890, 12950, 13020, 13100],
                        backgroundColor: 'rgba(33, 150, 243, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function initChemicalConsumptionChart() {
            const ctx = document.getElementById('chemicalConsumptionChart').getContext('2d');
            charts.chemicalConsumptionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Koagulan', 'Klorin', 'Flokulan', 'Lainnya'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: [
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(76, 175, 80, 0.7)',
                            'rgba(33, 150, 243, 0.7)',
                            'rgba(156, 39, 176, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        function initEnergyConsumptionChart() {
            const ctx = document.getElementById('energyConsumptionChart').getContext('2d');
            charts.energyConsumptionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Pompa', 'Filtrasi', 'Pencampur', 'Lighting', 'Control'],
                    datasets: [{
                        label: 'Konsumsi Energi (kWh)',
                        data: [45, 28, 15, 8, 5],
                        backgroundColor: 'rgba(255, 87, 34, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function updateChartData() {
            // Update quality chart dengan data baru
            if (charts.qualityChart) {
                const newData = charts.qualityChart.data.datasets[0].data;
                const lastValue = newData[newData.length - 1];
                newData.shift();
                newData.push(lastValue + (Math.random() - 0.5) * 0.1);
                charts.qualityChart.update();
            }
            
            // Update flow chart
            if (charts.flowChart) {
                const newData = charts.flowChart.data.datasets[0].data;
                const lastValue = newData[newData.length - 1];
                newData.shift();
                newData.push(120 + (Math.random() - 0.5) * 2);
                charts.flowChart.update();
            }
        }
        
        // ========== FUNGSI PRODUKSI & HISTORI ==========
        
        function loadProductionHistory() {
            productionHistory = [
                { id: 'BATCH-001', date: '27/12/2024', volume: 1000, bottleSize: 330, quality: 99.2, status: 'Selesai' },
                { id: 'BATCH-002', date: '26/12/2024', volume: 1000, bottleSize: 600, quality: 98.8, status: 'Selesai' },
                { id: 'BATCH-003', date: '25/12/2024', volume: 1000, bottleSize: 1500, quality: 99.5, status: 'Selesai' },
                { id: 'BATCH-004', date: '24/12/2024', volume: 1000, bottleSize: 330, quality: 98.9, status: 'Selesai' },
                { id: 'BATCH-005', date: '23/12/2024', volume: 1000, bottleSize: 5000, quality: 99.1, status: 'Selesai' },
                { id: 'BATCH-006', date: '22/12/2024', volume: 1000, bottleSize: 600, quality: 99.3, status: 'Selesai' },
                { id: 'BATCH-007', date: '21/12/2024', volume: 1000, bottleSize: 330, quality: 98.7, status: 'Selesai' }
            ];
            
            // Update summary
            updateProductionSummary();
        }
        
        function updateProductionSummary() {
            const totalProduction = productionHistory.reduce((sum, prod) => sum + prod.volume, 0);
            const avgQuality = (productionHistory.reduce((sum, prod) => sum + parseFloat(prod.quality), 0) / productionHistory.length).toFixed(1);
            
            document.getElementById('totalProduction').textContent = totalProduction.toLocaleString() + ' L';
            document.getElementById('avgQuality').textContent = avgQuality + '%';
            document.getElementById('totalBatches').textContent = productionHistory.length;
            document.getElementById('avgEfficiency').textContent = '86.5%';
        }
        
        function updateRecentProduction() {
            const tableBody = document.getElementById('recentProduction');
            tableBody.innerHTML = '';
            
            const recent = productionHistory.slice(0, 5);
            
            recent.forEach(prod => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${prod.id}</td>
                    <td>${prod.date}</td>
                    <td>${prod.volume.toLocaleString()} L</td>
                    <td><span style="color: ${prod.quality >= 99 ? '#4CAF50' : prod.quality >= 98 ? '#FF9800' : '#F44336'}">${prod.quality}%</span></td>
                    <td><span style="color: #4CAF50; font-weight: bold;">${prod.status}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateHistoryTable() {
            const tableBody = document.getElementById('historyTable');
            tableBody.innerHTML = '';
            
            productionHistory.forEach(prod => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${prod.id}</td>
                    <td>${prod.date}</td>
                    <td>${prod.volume.toLocaleString()}</td>
                    <td>${prod.bottleSize} ml</td>
                    <td><span style="color: ${prod.quality >= 99 ? '#4CAF50' : prod.quality >= 98 ? '#FF9800' : '#F44336'}">${prod.quality}%</span></td>
                    <td><span style="color: #4CAF50; font-weight: bold;">${prod.status}</span></td>
                    <td>
                        <button onclick="viewBatchDetail('${prod.id}')" style="padding: 5px 10px; background: rgba(255, 193, 7, 0.2); color: var(--accent-yellow); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 5px; cursor: pointer; min-height: 36px; min-width: 36px;">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updateProductionSummary();
        }
        
        function startProduction() {
            const batchId = 'BATCH-' + Date.now().toString().slice(-6);
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID');
            const volume = 1000;
            const quality = (99.0 + Math.random() * 0.5 - 0.25).toFixed(1);
            
            const newProduction = {
                id: batchId,
                date: dateStr,
                volume: volume,
                bottleSize: selectedBottleSize,
                quality: quality,
                status: 'Selesai'
            };
            
            productionHistory.unshift(newProduction);
            updateRecentProduction();
            updateHistoryTable();
            
            showNotification('Produksi batch ' + batchId + ' dimulai!', 'success');
            
            setTimeout(() => {
                showNotification('Produksi batch ' + batchId + ' selesai dengan kualitas ' + quality + '%', 'success');
            }, 3000);
        }
        
        function pauseProduction() {
            showNotification('Produksi dijeda.', 'warning');
        }
        
        function filterHistory(filter) {
            showNotification('Filter ' + filter + ' diterapkan.', 'info');
        }
        
        function clearHistory(scope) {
            if (scope === 'today') {
                const today = new Date().toLocaleDateString('id-ID');
                productionHistory = productionHistory.filter(p => p.date !== today);
                showNotification('Histori hari ini dihapus.', 'success');
            } else if (scope === 'all') {
                productionHistory = [];
                showNotification('Semua histori dihapus.', 'success');
            }
            
            updateRecentProduction();
            updateHistoryTable();
        }
        
        function viewBatchDetail(batchId) {
            const batch = productionHistory.find(p => p.id === batchId);
            if (batch) {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div style="background: var(--light-black); border-radius: 15px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-width: 500px; width: 90%;">
                        <div style="padding: 20px;">
                            <h2 style="color: var(--accent-yellow); margin-bottom: 15px;">Detail Batch: ${batch.id}</h2>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <p style="color: #BDBDBD; font-size: 0.9rem;">Tanggal Produksi</p>
                                    <p style="color: white; font-weight: bold;">${batch.date}</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; font-size: 0.9rem;">Volume</p>
                                    <p style="color: white; font-weight: bold;">${batch.volume.toLocaleString()} L</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; font-size: 0.9rem;">Ukuran Botol</p>
                                    <p style="color: white; font-weight: bold;">${batch.bottleSize} ml</p>
                                </div>
                                <div>
                                    <p style="color: #BDBDBD; font-size: 0.9rem;">Kualitas</p>
                                    <p style="color: ${batch.quality >= 99 ? '#4CAF50' : batch.quality >= 98 ? '#FF9800' : '#F44336'}; font-weight: bold;">${batch.quality}%</p>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 15px 20px; background: rgba(34,34,34,0.8); display: flex; justify-content: flex-end;">
                            <button onclick="this.closest('.modal').remove()" style="padding: 12px 25px; background: var(--accent-yellow); color: var(--dark-black); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; min-height: 44px; min-width: 80px;">
                                Tutup
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
        }
        
        // ========== FUNGSI BOTOL ==========
        
        function selectBottle(size) {
            selectedBottleSize = size;
            
            // Update active class
            document.querySelectorAll('.bottle-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to clicked card
            event.target.closest('.bottle-card').classList.add('active');
            
            updateBottleCalculations();
        }
        
        function updateBottleCalculations() {
            const bottleData = {
                330: { price: 3500, productionTime: 45 },
                600: { price: 5000, productionTime: 60 },
                1500: { price: 10000, productionTime: 90 },
                5000: { price: 25000, productionTime: 120 }
            };
            
            const data = bottleData[selectedBottleSize];
            const batchVolume = 1000; // 1000 liter per batch
            const bottlesPerBatch = Math.floor(batchVolume / (selectedBottleSize / 1000));
            const estimatedRevenue = bottlesPerBatch * data.price;
            
            document.getElementById('selectedBottleSize').textContent = selectedBottleSize + ' ml';
            document.getElementById('bottlesPerBatch').textContent = bottlesPerBatch.toLocaleString() + ' botol';
            document.getElementById('estimatedRevenue').textContent = 'Rp ' + estimatedRevenue.toLocaleString();
            document.getElementById('productionTime').textContent = data.productionTime + ' menit';
            
            updateBatchCalculations();
        }
        
        function updateBatchCalculations() {
            const batchCount = parseInt(document.getElementById('batchCount').value) || 1;
            const bottlesPerBatch = parseInt(document.getElementById('bottlesPerBatch').textContent.replace(',', '')) || 3030;
            const revenuePerBatch = parseInt(document.getElementById('estimatedRevenue').textContent.replace('Rp ', '').replace(',', '')) || 10605000;
            const timePerBatch = parseInt(document.getElementById('productionTime').textContent) || 45;
            
            document.getElementById('totalBottles').textContent = (batchCount * bottlesPerBatch).toLocaleString();
            document.getElementById('totalRevenue').textContent = 'Rp ' + (batchCount * revenuePerBatch).toLocaleString();
            document.getElementById('totalTime').textContent = (batchCount * timePerBatch) + ' menit';
        }
        
        function calculateProductionPlan() {
            document.getElementById('productionPlan').style.display = 'block';
            showNotification('Rencana produksi berhasil dihitung!', 'success');
        }
        
        function updateChemical(type, value) {
            if (type === 'coagulant') {
                document.getElementById('coagulantValue').textContent = value + ' mg/L';
            } else if (type === 'ph') {
                document.getElementById('phValue').textContent = value + '  0.2';
            }
        }
        
        // ========== FUNGSI ANALITIK ==========
        
        function generateAIRecommendations() {
            if (!isAIActive) return;
            
            const recommendations = [
                {
                    title: "Optimasi Koagulan",
                    description: "AI mendeteksi penggunaan koagulan berlebih. Rekomendasi: turunkan 5mg/L untuk efisiensi biaya tanpa mengurangi kualitas.",
                    impact: "Penghematan: Rp 2.5 juta/bulan"
                },
                {
                    title: "Penjadwalan Pompa",
                    description: "Analisis pola penggunaan menunjukkan waktu idle pompa dapat dimanfaatkan untuk maintenance.",
                    impact: "Peningkatan lifetime equipment: 15%"
                },
                {
                    title: "Prediksi Kebutuhan Maintenance",
                    description: "Sistem AI memprediksi filter membutuhkan penggantian dalam 7 hari berdasarkan data tekanan.",
                    impact: "Hindari downtime: 95% confidence"
                }
            ];
            
            const container = document.getElementById('aiRecommendations');
            if (!container) return;
            
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.style.cssText = 'background: rgba(255, 255, 255, 0.05); padding: 12px; margin-bottom: 10px; border-radius: 6px; display: flex; align-items: center; gap: 10px;';
                recElement.innerHTML = `
                    <div style="width: 24px; height: 24px; background: var(--accent-yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-lightbulb" style="color: var(--dark-black); font-size: 0.8rem;"></i>
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: white; margin-bottom: 5px; font-size: 0.95rem;">${rec.title}</h4>
                        <p style="color: var(--accent-light); margin-bottom: 5px; font-size: 0.85rem;">${rec.description}</p>
                        <span style="color: var(--accent-yellow); font-size: 0.8rem; font-weight: bold;">${rec.impact}</span>
                    </div>
                `;
                container.appendChild(recElement);
            });
        }
        
        // ========== FUNGSI EKSPOR ==========
        
        function exportDashboardPDF() {
            showNotification('Membuat laporan dashboard...', 'info');
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(255, 193, 7);
                doc.text('LAPORAN DASHBOARD PDAM AI', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('Tanggal: ' + new Date().toLocaleDateString('id-ID'), 105, 30, { align: 'center' });
                
                // Stats
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text('Statistik Utama:', 20, 45);
                
                const stats = [
                    ['Produksi Hari Ini', document.getElementById('todayProduction').textContent],
                    ['Kualitas Air', document.getElementById('waterQuality').textContent],
                    ['Efisiensi Energi', document.getElementById('energyEfficiency').textContent],
                    ['Penggunaan Kimia', document.getElementById('chemicalUsage').textContent]
                ];
                
                doc.autoTable({
                    startY: 50,
                    head: [['Parameter', 'Nilai']],
                    body: stats,
                    theme: 'striped',
                    headStyles: { fillColor: [255, 193, 7] }
                });
                
                // Save PDF
                doc.save('laporan-dashboard-pdam-ai.pdf');
                showNotification('Laporan dashboard berhasil diekspor ke PDF!', 'success');
            }, 1000);
        }
        
        function exportProcessPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('LAPORAN PROSES PENGOLAHAN', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('Status: ' + (is3DProcessRunning ? 'Berjalan' : 'Berhenti'), 105, 30, { align: 'center' });
            
            const processData = [
                ['Tahap', 'Status', 'Flow (L/detik)'],
                ['Intake', 'Aktif', '120'],
                ['Koagulasi', 'Aktif', '115'],
                ['Sedimentasi', 'Aktif', '110'],
                ['Filtrasi', 'Aktif', '105'],
                ['Desinfeksi', 'Aktif', '100'],
                ['Distribusi', 'Siap', '95']
            ];
            
            doc.autoTable({
                startY: 40,
                head: [processData[0]],
                body: processData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [33, 150, 243] }
            });
            
            doc.save('laporan-proses-pengolahan.pdf');
            showNotification('Laporan proses berhasil diekspor ke PDF!', 'success');
        }
        
        function exportProcessCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Tahap,Status,Flow (L/detik)\n"
                + "Intake,Aktif,120\n"
                + "Koagulasi,Aktif,115\n"
                + "Sedimentasi,Aktif,110\n"
                + "Filtrasi,Aktif,105\n"
                + "Desinfeksi,Aktif,100\n"
                + "Distribusi,Siap,95";
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-proses.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data proses berhasil diekspor ke CSV!', 'success');
        }
        
        function exportMonitoringPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('LAPORAN MONITORING REAL-TIME', 105, 20, { align: 'center' });
            
            const monitoringData = [
                ['Parameter', 'Nilai', 'Unit', 'Status'],
                ['Debit Air Masuk', monitoringData.flowIn.toFixed(1), 'L/detik', 'Stabil'],
                ['Tekanan Sistem', monitoringData.systemPressure.toFixed(2), 'Bar', 'Normal'],
                ['Tingkat Kekeruhan', monitoringData.turbidity.toFixed(1), 'NTU', 'Baik'],
                ['Suhu Air', monitoringData.waterTemp.toFixed(1), 'C', 'Optimal']
            ];
            
            doc.autoTable({
                startY: 30,
                head: [monitoringData[0]],
                body: monitoringData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [76, 175, 80] }
            });
            
            doc.save('laporan-monitoring.pdf');
            showNotification('Laporan monitoring berhasil diekspor ke PDF!', 'success');
        }
        
        function exportMonitoringCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Parameter,Nilai,Unit,Status\n"
                + `Debit Air Masuk,${monitoringData.flowIn.toFixed(1)},L/detik,Stabil\n`
                + `Tekanan Sistem,${monitoringData.systemPressure.toFixed(2)},Bar,Normal\n`
                + `Tingkat Kekeruhan,${monitoringData.turbidity.toFixed(1)},NTU,Baik\n`
                + `Suhu Air,${monitoringData.waterTemp.toFixed(1)},C,Optimal`;
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-monitoring.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data monitoring berhasil diekspor ke CSV!', 'success');
        }
        
        function exportHistoryPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('LAPORAN HISTORI PRODUKSI', 105, 20, { align: 'center' });
            
            const historyData = productionHistory.slice(0, 10).map(prod => [
                prod.id,
                prod.date,
                prod.volume.toString(),
                prod.bottleSize + ' ml',
                prod.quality + '%',
                prod.status
            ]);
            
            doc.autoTable({
                startY: 30,
                head: [['ID Batch', 'Tanggal', 'Volume (L)', 'Ukuran Botol', 'Kualitas', 'Status']],
                body: historyData,
                theme: 'striped',
                headStyles: { fillColor: [255, 152, 0] }
            });
            
            doc.save('laporan-histori-produksi.pdf');
            showNotification('Laporan histori berhasil diekspor ke PDF!', 'success');
        }
        
        function exportHistoryCSV() {
            let csvContent = "data:text/csv;charset=utf-8,ID Batch,Tanggal,Volume (L),Ukuran Botol,Kualitas,Status\n";
            
            productionHistory.slice(0, 10).forEach(prod => {
                csvContent += `${prod.id},${prod.date},${prod.volume},${prod.bottleSize} ml,${prod.quality}%,${prod.status}\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-histori.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data histori berhasil diekspor ke CSV!', 'success');
        }
        
        function exportAnalyticsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('LAPORAN ANALITIK PDAM AI', 105, 20, { align: 'center' });
            
            const analyticsData = [
                ['Parameter', 'Nilai', 'Trend'],
                ['OEE (Overall Equipment Effectiveness)', '84.7%', ' 2.3%'],
                ['MTBF (Mean Time Between Failure)', '142 jam', ' 8%'],
                ['Yield Rate', '96.2%', ' 1.5%'],
                ['Cost per Liter', 'Rp 450', ' 5.2%'],
                ['Chemical Cost', 'Rp 12.5 jt', ' 8.3%'],
                ['Energy Cost', 'Rp 8.2 jt', ' 12.1%']
            ];
            
            doc.autoTable({
                startY: 30,
                head: [analyticsData[0]],
                body: analyticsData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [156, 39, 176] }
            });
            
            doc.save('laporan-analitik.pdf');
            showNotification('Laporan analitik berhasil diekspor ke PDF!', 'success');
        }
        
        function exportAnalyticsCSV() {
            const csvContent = "data:text/csv;charset=utf-8,Parameter,Nilai,Trend\n"
                + "OEE (Overall Equipment Effectiveness),84.7%, 2.3%\n"
                + "MTBF (Mean Time Between Failure),142 jam, 8%\n"
                + "Yield Rate,96.2%, 1.5%\n"
                + "Cost per Liter,Rp 450, 5.2%\n"
                + "Chemical Cost,Rp 12.5 jt, 8.3%\n"
                + "Energy Cost,Rp 8.2 jt, 12.1%";
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-analitik.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data analitik berhasil diekspor ke CSV!', 'success');
        }
        
        function exportBottlePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('LAPORAN PRODUKSI BOTOL', 105, 20, { align: 'center' });
            
            const bottleData = [
                ['Ukuran Botol', 'Jumlah/Batch', 'Harga/Botol', 'Waktu Produksi'],
                ['330 ml', '3,030 botol', 'Rp 3.500', '45 menit'],
                ['600 ml', '1,667 botol', 'Rp 5.000', '60 menit'],
                ['1.5 L', '667 botol', 'Rp 10.000', '90 menit'],
                ['5 L', '200 botol', 'Rp 25.000', '120 menit']
            ];
            
            doc.autoTable({
                startY: 30,
                head: [bottleData[0]],
                body: bottleData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [33, 150, 243] }
            });
            
            doc.save('laporan-produksi-botol.pdf');
            showNotification('Laporan botol berhasil diekspor ke PDF!', 'success');
        }
        
        function exportBottleCSV() {
            const csvContent = "data:text/csv;charset=utf-8,Ukuran Botol,Jumlah/Batch,Harga/Botol,Waktu Produksi\n"
                + "330 ml,3030 botol,Rp 3500,45 menit\n"
                + "600 ml,1667 botol,Rp 5000,60 menit\n"
                + "1.5 L,667 botol,Rp 10000,90 menit\n"
                + "5 L,200 botol,Rp 25000,120 menit";
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-botol.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data botol berhasil diekspor ke CSV!', 'success');
        }
        
        function exportTeamPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('DATA TIM PDAM AI', 105, 20, { align: 'center' });
            
            const teamData = [
                ['Nama', 'Posisi', 'Kontak'],
                ['Ridho Kurniawan', 'CEO', 'ridho.kurniawan@pdam-ai.id'],
                ['Ahmad Fauzi', 'Koordinator Operasional', 'operasional@pdam-ai.id'],
                ['Budi Santoso', 'Koordinator Teknik', 'teknik@pdam-ai.id'],
                ['Sarah Maulida', 'Lead Data Science', 'data.science@pdam-ai.id']
            ];
            
            doc.autoTable({
                startY: 30,
                head: [teamData[0]],
                body: teamData.slice(1),
                theme: 'striped',
                headStyles: { fillColor: [255, 87, 34] }
            });
            
            doc.save('data-tim-pdam-ai.pdf');
            showNotification('Data tim berhasil diekspor ke PDF!', 'success');
        }
        
        function exportTeamCSV() {
            const csvContent = "data:text/csv;charset=utf-8,Nama,Posisi,Kontak\n"
                + "Ridho Kurniawan,CEO,ridho.kurniawan@pdam-ai.id\n"
                + "Ahmad Fauzi,Koordinator Operasional,operasional@pdam-ai.id\n"
                + "Budi Santoso,Koordinator Teknik,teknik@pdam-ai.id\n"
                + "Sarah Maulida,Lead Data Science,data.science@pdam-ai.id";
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-tim.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data tim berhasil diekspor ke CSV!', 'success');
        }
        
        function exportMapPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(255, 193, 7);
            doc.text('DATA PDAM INDONESIA', 105, 20, { align: 'center' });
            
            const pdamDataTable = pdamData.map(pdam => [
                pdam.name,
                pdam.address,
                pdam.capacity + ' L/detik',
                pdam.quality + '%',
                pdam.recommendation
            ]);
            
            doc.autoTable({
                startY: 30,
                head: [['Nama PDAM', 'Alamat', 'Kapasitas', 'Kualitas', 'Rekomendasi']],
                body: pdamDataTable,
                theme: 'striped',
                headStyles: { fillColor: [76, 175, 80] }
            });
            
            doc.save('data-pdam-indonesia.pdf');
            showNotification('Data peta berhasil diekspor ke PDF!', 'success');
        }
        
        function exportMapCSV() {
            let csvContent = "data:text/csv;charset=utf-8,Nama PDAM,Alamat,Kapasitas,Kualitas,Rekomendasi\n";
            
            pdamData.forEach(pdam => {
                csvContent += `"${pdam.name}","${pdam.address}",${pdam.capacity} L/detik,${pdam.quality}%,"${pdam.recommendation}"\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "data-pdam.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data peta berhasil diekspor ke CSV!', 'success');
        }
        
        // ========== FUNGSI LAINNYA ==========
        
        function simulateRealTimeData() {
            // Random update pada data statistik
            const todayProduction = document.getElementById('todayProduction');
            const currentValue = parseFloat(todayProduction.textContent.replace(',', '').replace(' L', ''));
            todayProduction.textContent = (currentValue + Math.random() * 100 - 50).toFixed(0) + ' L';
            
            const waterQuality = document.getElementById('waterQuality');
            const currentQuality = parseFloat(waterQuality.textContent.replace('%', ''));
            waterQuality.textContent = (currentQuality + Math.random() * 0.2 - 0.1).toFixed(1) + '%';
            
            showNotification('Data real-time disimulasikan.', 'info');
        }
        
        // Pastikan semua fungsi tersedia secara global
        window.showSection = showSection;
        window.toggleAIMode = toggleAIMode;
        window.selectBottle = selectBottle;
        window.updateBatchCalculations = updateBatchCalculations;
        window.calculateProductionPlan = calculateProductionPlan;
        window.start3DProcess = start3DProcess;
        window.pause3DProcess = pause3DProcess;
        window.reset3DProcess = reset3DProcess;
        window.updateAnimationSpeed = updateAnimationSpeed;
        window.change3DView = change3DView;
        window.rotate3DView = rotate3DView;
        window.zoom3DView = zoom3DView;
        window.reset3DView = reset3DView;
        window.updateChemical = updateChemical;
        window.generateRecommendation = generateRecommendation;
        window.zoomToIndonesia = zoomToIndonesia;
        window.zoomToAllMarkers = zoomToAllMarkers;
        window.showAllInfo = showAllInfo;
        window.startProduction = startProduction;
        window.pauseProduction = pauseProduction;
        window.filterHistory = filterHistory;
        window.clearHistory = clearHistory;
        window.exportHistoryPDF = exportHistoryPDF;
        window.exportHistoryCSV = exportHistoryCSV;
        window.viewBatchDetail = viewBatchDetail;
        window.simulateRealTimeData = simulateRealTimeData;
        window.exportDashboardPDF = exportDashboardPDF;
        window.exportProcessPDF = exportProcessPDF;
        window.exportProcessCSV = exportProcessCSV;
        window.exportMonitoringPDF = exportMonitoringPDF;
        window.exportMonitoringCSV = exportMonitoringCSV;
        window.exportAnalyticsPDF = exportAnalyticsPDF;
        window.exportAnalyticsCSV = exportAnalyticsCSV;
        window.exportBottlePDF = exportBottlePDF;
        window.exportBottleCSV = exportBottleCSV;
        window.exportTeamPDF = exportTeamPDF;
        window.exportTeamCSV = exportTeamCSV;
        window.exportMapPDF = exportMapPDF;
        window.exportMapCSV = exportMapCSV;
        window.toggleMobileMenu = toggleMobileMenu;
        window.closeMobileMenu = closeMobileMenu;
    </script>
</body>
</html>